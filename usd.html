<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¨Ø§Ø¨â€ŒØ³Ù†Ø¬ Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡</title>
    <style>
        body {
            font-family: 'B Nazanin', 'Vazirmatn', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            direction: rtl;
            text-align: right;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d4af37;
            text-align: center;
            margin-bottom: 20px;
        }
        .price-item, .bubble-item, .advice {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-right: 4px solid #d4af37;
        }
        .price-item strong, .bubble-item strong {
            color: #d4af37;
        }
        #loading-message {
            text-align: center;
            color: #666;
            font-size: 1.2em;
        }
        .positive-bubble {
            color: #e74c3c; /* Red */
        }
        .negative-bubble {
            color: #2ecc71; /* Green */
        }
        .advice {
            border-right: 4px solid #3498db;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Ø­Ø¨Ø§Ø¨â€ŒØ³Ù†Ø¬ Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡ ğŸ’°</h1>
    
    <div id="loading-message">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>

    <div id="price-data" style="display:none;">
        <div class="price-item">
            <strong>Ù‚ÛŒÙ…Øª Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ:</strong> <span id="seke-price"></span> Ø±ÛŒØ§Ù„
        </div>
        <div class="price-item">
            <strong>Ù‚ÛŒÙ…Øª Ø§ÙˆÙ†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ:</strong> <span id="ounce-price"></span> Ø¯Ù„Ø§Ø±
        </div>
        <div class="price-item">
            <strong>Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø±:</strong> <span id="usd-price"></span> Ø±ÛŒØ§Ù„
        </div>
    </div>

    <div id="bubble-data" style="display:none;">
        <div class="bubble-item">
            <strong>Ø­Ø¨Ø§Ø¨ Ø³Ú©Ù‡:</strong> <span id="seke-bubble"></span>%
        </div>
    </div>

    <div id="advice-box" style="display:none;">
        <div class="advice">
            <h3>ğŸ“ˆ ØªÙˆØµÛŒÙ‡ Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´</h3>
            <p id="advice-text"></p>
        </div>
    </div>
</div>

<script>
    const API_URL = 'https://gold2.chbk.app/get-prices';
    const OUNCE_GRAM = 31.103;
    const SEKE_GRAM = 8.133;

    async function getPricesAndCalculateBubble() {
        const loadingMessage = document.getElementById('loading-message');
        const priceData = document.getElementById('price-data');
        const bubbleData = document.getElementById('bubble-data');
        const adviceBox = document.getElementById('advice-box');
        const adviceText = document.getElementById('advice-text');

        loadingMessage.style.display = 'block';
        priceData.style.display = 'none';
        bubbleData.style.display = 'none';
        adviceBox.style.display = 'none';

        try {
            const response = await fetch(API_URL);
            const data = await response.json();

            // Replace commas and convert to numbers
            const sekePrice = parseFloat(data['Seke Emami'].replace(/,/g, ''));
            const ouncePrice = parseFloat(data['Gold Ounce'].replace(/,/g, ''));
            const usdPrice = parseFloat(data['USD'].replace(/,/g, ''));

            // Calculate intrinsic value
            const sekeIntrinsicValue = ((ouncePrice * usdPrice * SEKE_GRAM) / OUNCE_GRAM) * 10; // Convert to Rial from Toman

            // Calculate bubble
            const sekeBubble = ((sekePrice - sekeIntrinsicValue) / sekePrice) * 100;
            const formattedSekeBubble = sekeBubble.toFixed(2);

            // Display prices and bubble
            document.getElementById('seke-price').innerText = sekePrice.toLocaleString();
            document.getElementById('ounce-price').innerText = ouncePrice.toLocaleString();
            document.getElementById('usd-price').innerText = usdPrice.toLocaleString();
            
            const sekeBubbleSpan = document.getElementById('seke-bubble');
            sekeBubbleSpan.innerText = formattedSekeBubble;
            if (sekeBubble > 0) {
                sekeBubbleSpan.classList.add('positive-bubble');
                sekeBubbleSpan.classList.remove('negative-bubble');
            } else {
                sekeBubbleSpan.classList.add('negative-bubble');
                sekeBubbleSpan.classList.remove('positive-bubble');
            }

            // Provide advice based on bubble
            if (sekeBubble > 5) {
                adviceText.innerHTML = "ğŸ”´ <strong>Ø­Ø¨Ø§Ø¨ Ø³Ú©Ù‡ Ø¨Ù‡ Ø´Ø¯Øª Ù…Ø«Ø¨Øª Ø§Ø³Øª.</strong> ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± ØµÙˆØ±Øª ØªÙ…Ø§ÛŒÙ„ØŒ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙØ±ÙˆØ®ØªÙ‡ Ùˆ Ø·Ù„Ø§ (Ø¢Ø¨â€ŒØ´Ø¯Ù‡ ÛŒØ§ Ø´Ù…Ø´) Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.";
            } else if (sekeBubble > 0) {
                adviceText.innerHTML = "ğŸŸ¡ <strong>Ø­Ø¨Ø§Ø¨ Ø³Ú©Ù‡ Ù…Ø«Ø¨Øª Ø§Ø³Øª.</strong> Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø³Ú©Ù‡ Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯.";
            } else if (sekeBubble < -2) {
                adviceText.innerHTML = "ğŸŸ¢ <strong>Ø­Ø¨Ø§Ø¨ Ø³Ú©Ù‡ Ù…Ù†ÙÛŒ Ø§Ø³Øª.</strong> Ù‚ÛŒÙ…Øª Ø³Ú©Ù‡ Ú©Ù…ØªØ± Ø§Ø² Ø§Ø±Ø²Ø´ Ø°Ø§ØªÛŒ Ø¢Ù† Ø§Ø³Øª. Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÛŒÚ© ÙØ±ØµØª Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø§Ø´Ø¯.";
            } else {
                adviceText.innerHTML = "ğŸ”µ <strong>Ø­Ø¨Ø§Ø¨ Ø³Ú©Ù‡ Ù†Ø²Ø¯ÛŒÚ© Ø¨Ù‡ ØµÙØ± Ø§Ø³Øª.</strong> Ø¨Ø§Ø²Ø§Ø± Ø¯Ø± ØªØ¹Ø§Ø¯Ù„ Ù†Ø³Ø¨ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯.";
            }

            loadingMessage.style.display = 'none';
            priceData.style.display = 'block';
            bubbleData.style.display = 'block';
            adviceBox.style.display = 'block';

        } catch (error) {
            loadingMessage.innerText = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.";
            console.error('Error fetching data:', error);
        }
    }

    // Run on page load
    window.onload = getPricesAndCalculateBubble;

    // Optional: Refresh every 5 minutes
    setInterval(getPricesAndCalculateBubble, 300000); // 300000 ms = 5 minutes
</script>

</body>
</html>