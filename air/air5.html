<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="icon" type="image/png" sizes="32x32" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">

<meta name="apple-mobile-web-app-title" content="Ù‡ÙˆØ§ÛŒ Ù¾Ø§Ú© Ù¾Ù„Ø§Ø³">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="/manifest.webmanifest">
<title>Ù‡ÙˆØ§ÛŒ Ù¾Ø§Ú© Ù¾Ù„Ø§Ø³ | Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200..900&display=swap" rel="stylesheet">

<style>
    /* --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ --- */
    :root {
        /* ØªÙ… Ø¯Ø§Ø±Ú© (Ù¾ÛŒØ´â€ŒÙØ±Ø¶) - Ø¨Ø³ÛŒØ§Ø± ØªÛŒØ±Ù‡â€ŒØªØ± */
        --bg-color: #020617;
        --bg-gradient: linear-gradient(180deg, #020617 0%, #0f172a 100%);
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --glass-bg: rgba(15, 23, 42, 0.6);
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-highlight: rgba(255, 255, 255, 0.03);
        --glass-blur: 40px;
        --card-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.7);
        --inner-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.15);
        
        --accent-color: #34d399;
        --liquid-1: #4f46e5;
        --liquid-2: #db2777;
    }

    body.light-mode {
        --bg-color: #f8fafc;
        --bg-gradient: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%);
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --glass-bg: rgba(255, 255, 255, 0.75);
        --glass-border: rgba(255, 255, 255, 0.9);
        --glass-highlight: rgba(255, 255, 255, 0.8);
        --glass-blur: 30px;
        --card-shadow: 0 15px 35px -5px rgba(148, 163, 184, 0.35);
        --inner-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.9);
        
        --liquid-1: #60a5fa;
        --liquid-2: #f472b6;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }

    body {
        background-color: var(--bg-color);
        background-image: var(--bg-gradient);
        color: var(--text-primary);
        font-family: 'Vazirmatn', -apple-system, sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
        transition: background 0.5s ease, color 0.5s ease;
        position: relative;
    }

    /* --- Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…Ø§ÛŒØ¹ --- */
    .liquid-blob {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        overflow: hidden; z-index: 0; pointer-events: none;
    }
    .blob {
        position: absolute; border-radius: 50%;
        filter: blur(90px); opacity: 0.5;
        animation: floatBlob 15s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        mix-blend-mode: screen;
    }
    body.light-mode .blob { mix-blend-mode: multiply; opacity: 0.3; }

    .blob-1 { top: -20%; left: -20%; width: 60vw; height: 60vw; background: var(--liquid-1); }
    .blob-2 { bottom: -20%; right: -20%; width: 70vw; height: 70vw; background: var(--liquid-2); animation-delay: -7s; }
    
    @keyframes floatBlob {
        0% { transform: translate(0, 0) scale(1) rotate(0deg); }
        100% { transform: translate(40px, 60px) scale(1.1) rotate(10deg); }
    }

    /* --- Ø°Ø±Ø§Øª Ù…Ø¹Ù„Ù‚ --- */
    #particles {
        position: fixed; inset: 0; pointer-events: none; z-index: 5;
        background-image: none; background-size: 0 0;
        transition: opacity 0.5s;
    }
    body.weather-rain #particles {
        background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 0 L10 10' stroke='rgba(120,120,255,0.6)' stroke-width='1'/%3E%3C/svg%3E");
        animation: rainFall 0.6s linear infinite;
    }
    body.weather-snow #particles {
        background-image: radial-gradient(white 30%, transparent 30%);
        background-size: 10px 10px;
        animation: snowFall 4s linear infinite;
    }
    @keyframes rainFall { from { background-position: 0 0; } to { background-position: -10px 400px; } }
    @keyframes snowFall { from { background-position: 0 0; } to { background-position: 30px 200px; } }

    #app {
        position: relative; z-index: 10;
        padding: max(20px, env(safe-area-inset-top)) 24px 40px 24px;
        max-width: 550px; margin: 0 auto; width: 100%;
        display: flex; flex-direction: column; gap: 28px;
        padding-bottom: 100px;
    }

    .fade-in-up {
        animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0; transform: translateY(30px);
    }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    /* --- Ù‡Ø¯Ø± Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡) --- */
    header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        width: 100%;
    }
    
    .location-pill {
        display: flex; align-items: center; gap: 12px;
        background: var(--glass-bg); 
        border: 1px solid var(--glass-border);
        border-top: 1px solid var(--glass-highlight);
        padding: 12px 24px; border-radius: 50px;
        font-size: 16px; font-weight: 800; cursor: pointer;
        backdrop-filter: blur(var(--glass-blur)); 
        box-shadow: var(--card-shadow), var(--inner-shadow);
        transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        color: var(--text-primary);
        max-width: 60%; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø²Ø±Ú¯ Ø´Ø¯Ù† Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù†Ø§Ù… Ø´Ù‡Ø± */
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    
    /* Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ú†ÛŒØ¯Ù…Ø§Ù† Ø±Ø¯ÛŒÙÛŒ Ø¯Ù‚ÛŒÙ‚ */
    .header-actions { 
        display: flex; 
        gap: 12px; 
        align-items: center; 
        flex-direction: row; /* ØªØ¶Ù…ÛŒÙ† Ø§ÙÙ‚ÛŒ Ø¨ÙˆØ¯Ù† */
    }

    .btn-circle {
        width: 50px; height: 50px; border-radius: 50%;
        background: var(--glass-bg); 
        border: 1px solid var(--glass-border);
        border-top: 1px solid var(--glass-highlight);
        display: flex; align-items: center; justify-content: center;
        color: var(--text-primary); cursor: pointer; 
        backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--card-shadow), var(--inner-shadow);
        transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        flex-shrink: 0; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù„Ù‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ */
    }
    .btn-circle:hover, .location-pill:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.3), var(--inner-shadow); }
    .btn-circle:active, .location-pill:active { transform: scale(0.95); }

    /* --- Ú¯ÛŒØ¬ Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ --- */
    .hero-section {
        display: flex; flex-direction: column; align-items: center;
        position: relative; margin-top: 20px;
    }
    .gauge-wrapper { 
        width: 300px; height: 300px; position: relative; 
        filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3)); 
    }
    .gauge-svg { width: 100%; height: 100%; transform: rotate(-90deg); }
    .track { fill: none; stroke: var(--glass-border); stroke-width: 16; stroke-linecap: round; }
    .progress { 
        fill: none; stroke: var(--accent-color); stroke-width: 16; stroke-linecap: round;
        stroke-dasharray: 660; stroke-dashoffset: 660;
        transition: stroke-dashoffset 2s cubic-bezier(0.2, 0.8, 0.2, 1), stroke 1s;
        filter: drop-shadow(0 0 10px var(--accent-color));
    }
    .hero-center {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        text-align: center; display: flex; flex-direction: column; align-items: center;
    }
    .hero-val { 
        font-size: 90px; font-weight: 900; line-height: 0.9; letter-spacing: -3px; 
        text-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .hero-label { 
        font-size: 18px; font-weight: 800; color: #fff; margin-top: 15px; 
        background: var(--accent-color); padding: 8px 20px; border-radius: 30px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* --- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ --- */
    .glass-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-top: 1px solid var(--glass-highlight);
        border-radius: 32px; padding: 32px;
        backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--card-shadow), var(--inner-shadow);
        position: relative; overflow: hidden;
        transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    .glass-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 25px 50px -5px rgba(0, 0, 0, 0.6), var(--inner-shadow);
    }
    .glass-card::after {
        content: ''; position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
        transform: skewX(-20deg); pointer-events: none;
        animation: shine 8s infinite;
    }
    @keyframes shine { 0%, 85% { left: -100%; } 100% { left: 200%; } }

    /* --- Ú©Ø§Ø±Øª Ø¨ØµØ±ÛŒ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ --- */
    .weather-visual-card {
        display: flex; flex-direction: column; align-items: center; text-align: center;
        background: linear-gradient(160deg, var(--glass-bg) 0%, rgba(255,255,255,0.01) 100%);
        padding-top: 40px;
    }
    .weather-anim-container {
        width: 180px; height: 180px; margin-bottom: 10px;
        position: relative; z-index: 2;
        filter: drop-shadow(0 20px 40px rgba(0,0,0,0.25));
        transform: perspective(500px) translateZ(20px);
    }
    .visual-temp { 
        font-size: 80px; font-weight: 900; line-height: 1; margin-bottom: 8px; 
        text-shadow: 0 4px 12px rgba(0,0,0,0.1);
        background: linear-gradient(to bottom, var(--text-primary), var(--text-secondary));
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .visual-desc { 
        font-size: 22px; opacity: 1; margin-bottom: 30px; font-weight: 700; 
        color: var(--accent-color); letter-spacing: -0.5px;
    }
    .visual-grid {
        display: flex; gap: 20px; width: 100%; justify-content: center;
        margin-top: 20px; padding-top: 25px; 
        border-top: 1px solid var(--glass-border);
    }
    .v-item { display: flex; flex-direction: column; align-items: center; gap: 8px; flex: 1; }
    .v-icon { font-size: 24px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
    .v-val { font-size: 20px; font-weight: 800; color: var(--text-primary); }
    .v-lbl { font-size: 13px; font-weight: 500; color: var(--text-secondary); }

    /* --- Ú©Ø§Ø±Øª Ø¯ÙˆØ³ØªØ§Ù†Ù‡ --- */
    .friendly-card {
        text-align: right; border-right: 8px solid #fbbf24;
        background: linear-gradient(90deg, var(--glass-bg) 0%, rgba(0,0,0,0) 100%);
    }
    .friendly-title { 
        font-size: 20px; font-weight: 900; margin-bottom: 16px; 
        color: #fbbf24; display: flex; align-items: center; gap: 10px; 
        text-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
    }
    .friendly-text { 
        font-size: 16px; line-height: 2.1; font-weight: 500; 
        text-align: justify; color: var(--text-primary); opacity: 0.95;
    }

    /* --- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ --- */
    .info-card { padding-right: 36px; }
    .info-title { 
        font-size: 18px; font-weight: 900; margin-bottom: 16px; 
        display: flex; align-items: center; gap: 10px; 
    }
    .info-body { 
        font-size: 15px; line-height: 2; font-weight: 400; 
        color: var(--text-primary); opacity: 0.9; white-space: pre-line; text-align: justify; 
    }

    /* --- Ú¯Ø±ÛŒØ¯ Ø¢Ù„Ø§ÛŒÙ†Ø¯Ù‡â€ŒÙ‡Ø§ --- */
    .pollutant-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .p-card {
        background: var(--glass-bg); border-radius: 30px; padding: 24px;
        border: 1px solid var(--glass-border); border-top: 1px solid var(--glass-highlight);
        text-align: center;
        backdrop-filter: blur(var(--glass-blur));
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        box-shadow: var(--card-shadow), var(--inner-shadow);
    }
    .p-val { 
        font-size: 36px; font-weight: 900; margin: 12px 0; color: var(--accent-color); 
        text-shadow: 0 0 20px rgba(52, 211, 153, 0.3);
    }

    /* --- Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ SVG --- */
    .anim-sun { animation: spin 20s linear infinite; transform-origin: center; }
    .anim-cloud { animation: float 6s ease-in-out infinite; }
    .anim-rain { animation: rainDrop 0.8s linear infinite; }
    .anim-snow { animation: snowDrop 3s linear infinite; }
    .anim-thunder { animation: flash 5s infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    @keyframes rainDrop { 0% { transform: translateY(0); opacity:1; } 100% { transform: translateY(30px); opacity:0; } }
    @keyframes flash { 0%, 90%, 100% { opacity: 0; } 92%, 96% { opacity: 1; filter: drop-shadow(0 0 20px #facc15); } }

    /* --- Ù„ÙˆØ¯Ø± Ùˆ Ù…ÙˆØ¯Ø§Ù„ --- */
    #loader {
        position: fixed; inset: 0; background: var(--bg-color); z-index: 200;
        display: flex; justify-content: center; align-items: center; flex-direction: column;
        transition: opacity 0.6s;
    }
    .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100;
        backdrop-filter: blur(25px); display: flex; justify-content: center; align-items: flex-end;
        opacity: 0; pointer-events: none; transition: 0.4s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-sheet {
        width: 100%; max-width: 550px; background: var(--bg-color);
        border-top-left-radius: 40px; border-top-right-radius: 40px;
        padding: 36px; transform: translateY(100%); transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        border-top: 1px solid var(--glass-border);
        box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    }
    .modal-overlay.open .modal-sheet { transform: translateY(0); }
    .search-input {
        background: var(--glass-bg); border: 1px solid var(--glass-border);
        padding: 20px; border-radius: 24px; color: var(--text-primary); font-family: inherit; font-weight: 700;
        font-size: 18px; width: 100%; margin-top: 24px; text-align: center;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    .search-item { 
        padding: 20px; border-bottom: 1px solid var(--glass-border); cursor: pointer; text-align: center; 
        color: var(--text-primary); font-weight: 500; transition: 0.2s;
    }
    .search-item:hover { background: rgba(255,255,255,0.05); }

</style>
</head>
<body>

    <div class="liquid-blob">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <div id="particles"></div>
    
    <div id="loader">
        <svg width="80" height="80" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <defs>
                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:var(--accent-color);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:var(--liquid-1);stop-opacity:1" />
                </linearGradient>
            </defs>
            <circle cx="12" cy="12" r="10" fill="none" stroke-dasharray="32" stroke-dashoffset="32" stroke="url(#grad1)">
                <animate attributeName="stroke-dashoffset" from="64" to="0" dur="1.2s" repeatCount="indefinite"/>
                <animate attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="2s" repeatCount="indefinite"/>
            </circle>
        </svg>
        <div style="margin-top: 25px; font-size: 18px; font-weight: 700; opacity: 0.9; letter-spacing: -0.5px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¢Ø³Ù…Ø§Ù†...</div>
    </div>

    <div class="modal-overlay" id="search-modal">
        <div class="modal-sheet">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:22px; font-weight:900;">Ú©Ø¬Ø§ Ù‡Ø³ØªÛŒØ¯ØŸ</span>
                <button onclick="toggleSearch(false)" style="background:none; border:none; color:var(--text-primary); font-size:28px; cursor:pointer;">âœ•</button>
            </div>
            <input type="text" class="search-input" id="city-input" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: ØªÙ‡Ø±Ø§Ù†)" dir="rtl">
            <div id="search-list" style="margin-top:20px; max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="app">
        <header class="fade-in-up" style="animation-delay: 0.1s;">
            <div class="location-pill" onclick="toggleSearch(true)">
                <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                <span id="loc-name">ØªÙ‡Ø±Ø§Ù†</span>
            </div>
            
            <div class="header-actions">
                <div class="btn-circle" onclick="toggleTheme()" title="ØªØºÛŒÛŒØ± ØªÙ…">
                    <svg id="theme-icon" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </div>
                <div class="btn-circle" onclick="getLocation()" title="Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù…Ù†">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v20M2 12h20"/><circle cx="12" cy="12" r="6"/></svg>
                </div>
            </div>
        </header>

        <div class="hero-section fade-in-up" style="animation-delay: 0.2s;">
            <div class="gauge-wrapper">
                <svg class="gauge-svg" viewBox="0 0 240 240">
                    <circle class="track" cx="120" cy="120" r="110"></circle>
                    <circle id="aqi-ring" class="progress" cx="120" cy="120" r="110"></circle>
                </svg>
                <div class="hero-center">
                    <div class="hero-val" id="aqi-val">--</div>
                    <div class="hero-label" id="aqi-text">...</div>
                </div>
            </div>
        </div>

        <div class="glass-card friendly-card fade-in-up" style="animation-delay: 0.3s;">
            <div class="friendly-title">
                <span style="font-size: 24px;">ğŸ‘‹</span>
                <span>Ú¯Ø²Ø§Ø±Ø´ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§</span>
            </div>
            <div class="friendly-text" id="friendly-text">
                Ø¯Ø± Ø­Ø§Ù„ Ù†Ú¯Ø§Ø±Ø´ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø®ØªØµØ§ØµÛŒ...
            </div>
        </div>

        <div class="glass-card weather-visual-card fade-in-up" style="animation-delay: 0.4s;">
            <div class="weather-anim-container" id="weather-icon-container"></div>
            <div class="visual-temp" id="visual-temp">--Â°</div>
            <div class="visual-desc" id="visual-desc">--</div>
            
            <div class="visual-grid">
                <div class="v-item">
                    <span class="v-icon" style="color:#60a5fa">ğŸ’§</span>
                    <span class="v-val" id="hum-val">--%</span>
                    <span class="v-lbl">Ø±Ø·ÙˆØ¨Øª Ù†Ø³Ø¨ÛŒ</span>
                </div>
                <div class="v-item">
                    <span class="v-icon" style="color:#a78bfa">ğŸ’¨</span>
                    <span class="v-val" id="wind-val">--</span>
                    <span class="v-lbl">Ø¨Ø§Ø¯ (Ú©ÛŒÙ„ÙˆÙ…ØªØ±/Ø³Ø§Ø¹Øª)</span>
                </div>
            </div>
        </div>

        <div class="glass-card info-card fade-in-up" style="animation-delay: 0.5s; border-right: 8px solid var(--accent-color);">
            <div class="info-title" style="color:var(--accent-color);">
                <span style="font-size: 22px;">ğŸƒ</span>
                <span id="aqi-reco-head">ØªÙˆØµÛŒÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ù„Ø§Ù…ØªÛŒ</span>
            </div>
            <div class="info-body" id="aqi-reco-body">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ...</div>
        </div>

        <div class="glass-card info-card fade-in-up" style="animation-delay: 0.6s; border-right: 8px solid #60a5fa;">
            <div class="info-title" style="color:#60a5fa;">
                <span id="story-icon" style="font-size: 22px;">âœ¨</span>
                <span id="story-head">Ø¯Ø§Ø³ØªØ§Ù† Ø¢Ø³Ù…Ø§Ù†</span>
            </div>
            <div class="info-body" id="story-body">Ø¯Ø± Ø­Ø§Ù„ Ø´Ù†ÛŒØ¯Ù† ØµØ¯Ø§ÛŒ Ø¢Ø³Ù…Ø§Ù†...</div>
        </div>
        
        <div class="glass-card info-card fade-in-up" style="animation-delay: 0.7s; border-right: 8px solid #818cf8;">
            <div class="info-title" style="color:#818cf8;">
                <span style="font-size: 22px;">ğŸŒ§ï¸</span>
                <span>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨Ø§Ø±Ø´ (Û²Û´ Ø³Ø§Ø¹Øª)</span>
            </div>
            <div>
                <div style="font-size:18px; font-weight:900; margin-bottom: 8px;" id="rain-title">--</div>
                <div style="font-size:15px; opacity:0.8; line-height:1.8; text-align:justify;" id="rain-desc">--</div>
            </div>
        </div>

        <div class="pollutant-grid fade-in-up" style="animation-delay: 0.8s;">
            <div class="p-card">
                <span style="font-size:32px; margin-bottom: 5px;">ğŸ˜·</span>
                <div class="p-val" id="pm25-val">--</div>
                <div style="font-size:14px; font-weight:700; opacity:0.7;">Ø°Ø±Ø§Øª PM2.5</div>
            </div>
            <div class="p-card">
                <span style="font-size:32px; margin-bottom: 5px;">ğŸŒ«ï¸</span>
                <div class="p-val" id="no2-val">--</div>
                <div style="font-size:14px; font-weight:700; opacity:0.7;">Ø¯ÛŒâ€ŒØ§Ú©Ø³ÛŒØ¯ Ù†ÛŒØªØ±ÙˆÚ˜Ù†</div>
            </div>
        </div>

        <footer class="fade-in-up" style="animation-delay: 0.9s; text-align:center; font-size:14px; font-weight:500; opacity:0.4; margin-top:40px;">
            Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ ØªÙˆØ³Ø· Ù¾ÛŒÙ…Ø§Ù† Ø¹Ø§Ø¨Ø¯ÛŒÙ† Ù¾ÙˆØ± ğŸŒ
        </footer>
    </div>

<script>
    const toFarsi = (n) => n?.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]) || '-';
    let isLight = false;

    // --- ØªØºÛŒÛŒØ± ØªÙ… (Ø¯Ø§Ø±Ú©/Ù„Ø§ÛŒØª) ---
    function toggleTheme() {
        isLight = !isLight;
        document.body.classList.toggle('light-mode');
        const icon = document.getElementById('theme-icon');
        if(isLight) {
            icon.innerHTML = '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>';
        } else {
            icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
        }
    }

    // --- Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ SVG ---
    function getWeatherSVG(code, isDay) {
        const sunColor = "#facc15";
        const cloudColor = isLight ? "#94a3b8" : "#cbd5e1"; 
        const cloudFilter = "filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));";
        
        if (code <= 1) return isDay ? 
            `<svg viewBox="0 0 100 100" overflow="visible"><defs><filter id="glow"><feGaussianBlur stdDeviation="5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><circle cx="50" cy="50" r="24" fill="${sunColor}" filter="url(#glow)"><animate attributeName="r" values="24;28;24" dur="4s" repeatCount="indefinite"/></circle><g class="anim-sun" stroke="${sunColor}" stroke-width="4" stroke-linecap="round"><line x1="50" y1="10" x2="50" y2="-5"/><line x1="50" y1="90" x2="50" y2="105"/><line x1="10" y1="50" x2="-5" y2="50"/><line x1="90" y1="50" x2="105" y2="50"/><line x1="22" y1="22" x2="12" y2="12"/><line x1="78" y1="78" x2="88" y2="88"/><line x1="22" y1="78" x2="12" y2="88"/><line x1="78" y1="22" x2="88" y2="12"/></g></svg>` : 
            `<svg viewBox="0 0 100 100"><path d="M40 20 A30 30 0 1 0 80 70 A20 20 0 1 1 40 20" fill="#f1f5f9" filter="drop-shadow(0 0 20px rgba(255,255,255,0.6))"/><circle cx="65" cy="45" r="3" fill="#94a3b8" opacity="0.6"/><circle cx="50" cy="65" r="4" fill="#94a3b8" opacity="0.4"/></svg>`;
        
        if (code <= 3) return `<svg viewBox="0 0 100 100" overflow="visible"><path class="anim-cloud" d="M25,60 a20,20 0 0,1 0,-40 a20,20 0 0,1 40,0 a20,20 0 0,1 0,40 z" fill="${cloudColor}" stroke="white" stroke-width="1.5" style="${cloudFilter}"/></svg>`;
        
        if (code <= 67 || code >= 80 && code <= 82) return `<svg viewBox="0 0 100 100" overflow="visible"><path class="anim-cloud" d="M25,60 a20,20 0 0,1 0,-40 a20,20 0 0,1 40,0 a20,20 0 0,1 0,40 z" fill="${cloudColor}" style="${cloudFilter}"/><g class="anim-rain"><line x1="35" y1="65" x2="30" y2="85" stroke="#60a5fa" stroke-width="4" stroke-linecap="round"/><line x1="50" y1="65" x2="45" y2="90" stroke="#60a5fa" stroke-width="4" stroke-linecap="round"/><line x1="65" y1="65" x2="60" y2="85" stroke="#60a5fa" stroke-width="4" stroke-linecap="round"/></g></svg>`;
        
        if (code >= 71 && code <= 77 || code >= 85) return `<svg viewBox="0 0 100 100" overflow="visible"><path class="anim-cloud" d="M25,60 a20,20 0 0,1 0,-40 a20,20 0 0,1 40,0 a20,20 0 0,1 0,40 z" fill="${cloudColor}" style="${cloudFilter}"/><g class="anim-snow"><circle cx="35" cy="75" r="5" fill="white"/><circle cx="55" cy="85" r="5" fill="white"/><circle cx="70" cy="70" r="5" fill="white"/></g></svg>`;
        
        if (code >= 95) return `<svg viewBox="0 0 100 100" overflow="visible"><path class="anim-cloud" d="M25,60 a20,20 0 0,1 0,-40 a20,20 0 0,1 40,0 a20,20 0 0,1 0,40 z" fill="#475569" style="${cloudFilter}"/><path class="anim-thunder" d="M45,60 L35,80 L50,80 L40,105" fill="none" stroke="#facc15" stroke-width="6" stroke-linejoin="round" filter="drop-shadow(0 0 15px #facc15)"/></svg>`;
        
        return `<svg viewBox="0 0 100 100"><g stroke="${cloudColor}" stroke-width="4" stroke-linecap="round"><line x1="20" y1="40" x2="80" y2="40"/><line x1="10" y1="60" x2="90" y2="60" opacity="0.7"/><line x1="30" y1="80" x2="70" y2="80" opacity="0.4"/></g></svg>`;
    }

    // --- ÙˆØ¶Ø¹ÛŒØª Ø¯ÙˆØ³ØªØ§Ù†Ù‡ ---
    function getFriendlyStatus(t, wCode, wind, hum, isDay) {
        let text = "";
        const timeGreeting = isDay ? "Ø³Ù„Ø§Ù…ØŒ ÙˆÙ‚Øª Ø¨Ø®ÛŒØ±! Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø±ÙˆØ² Ù¾Ø±Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø®ÙˆØ¨ÛŒ Ø±Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒ. " : "Ø³Ù„Ø§Ù…ØŒ Ø´Ø¨ Ø¨Ø®ÛŒØ± Ø¯ÙˆØ³Øª Ù…Ù†. Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø¢Ø±Ø§Ù…Ø´ Ø´Ø¨ Ø®Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§Øª Ø±Ùˆ Ø¨Ø´ÙˆØ±Ù‡. ";
        text += timeGreeting;

        if(t < 0) text += "Ø±Ø§Ø³ØªØ´ Ø±Ùˆ Ø¨Ø®ÙˆØ§ÛŒØŒ Ø¨ÛŒØ±ÙˆÙ† Ù‡ÙˆØ§ Ù†Ø§Ø¬ÙˆØ§Ù†Ù…Ø±Ø¯Ø§Ù†Ù‡ Ø³Ø±Ø¯Ù‡! ğŸ¥¶ Ø§Ù†Ú¯Ø§Ø± Ø²Ù…Ø³ØªÙˆÙ† Ø¨Ø§ ØªÙ…Ø§Ù… Ù‚ÙˆØ§ Ø§ÙˆÙ…Ø¯Ù‡. Ø­ØªÙ…Ø§Ù‹ Ú†Ù†Ø¯ Ù„Ø§ÛŒÙ‡ Ù„Ø¨Ø§Ø³ Ú¯Ø±Ù… Ø¨Ù¾ÙˆØ´ Ùˆ Ø§Ú¯Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØŒ ÛŒÙ‡ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ Ø¯Ø§Øº Ù‡Ù…Ø±Ø§Ù‡Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´. ";
        else if(t < 10) text += "Ù‡ÙˆØ§ Ø­Ø³Ø§Ø¨ÛŒ Ø³Ø±Ø¯Ù‡ Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ù¾Ø´Ù† Ùˆ Ø´Ø§Ù„â€ŒÚ¯Ø±Ø¯Ù† Ø¯Ø§Ø±ÛŒ. ğŸ§£ Ù…ÙˆØ§Ø¸Ø¨ Ø¨Ø§Ø´ Ø³Ø±Ù…Ø§ Ù†Ø®ÙˆØ±ÛŒ Ú†ÙˆÙ† Ø§ÛŒÙ† Ù‡ÙˆØ§ Ù…ÙˆØ°ÛŒØ§Ù†Ù‡ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ù‡! ";
        else if(t < 18) text += "Ù‡ÙˆØ§ ÛŒÙ‡ Ø®Ù†Ú©ÛŒ Ø®ÛŒÙ„ÛŒ Ù…Ù„Ø§ÛŒÙ… Ùˆ Ø´ÛŒÚ© Ø¯Ø§Ø±Ù‡. ğŸ§¥ ÛŒÙ‡ Ù„Ø¨Ø§Ø³ Ù¾Ø§ÛŒÛŒØ²ÛŒ ÛŒØ§ ÛŒÙ‡ Ú˜Ø§Ú©Øª Ø³Ø¨Ú© Ú©Ø§ÙÛŒÙ‡ ØªØ§ Ø§Ø² Ø§ÛŒÙ† Ù‡ÙˆØ§ Ù„Ø°Øª Ø¨Ø¨Ø±ÛŒ. ";
        else if(t < 27) text += "Ø§Ù„Ø§Ù† Ù‡ÙˆØ§ ØªÙˆÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ø­Ø§Ù„Øª Ù…Ù…Ú©Ù† Ø®ÙˆØ¯Ø´Ù‡! ğŸ˜ Ù†Ù‡ Ø§ÙˆÙ†Ù‚Ø¯Ø± Ú¯Ø±Ù…Ù‡ Ú©Ù‡ Ú©Ù„Ø§ÙÙ‡ Ø¨Ø´ÛŒØŒ Ù†Ù‡ Ø§ÙˆÙ†Ù‚Ø¯Ø± Ø³Ø±Ø¯ Ú©Ù‡ Ø¨Ù„Ø±Ø²ÛŒ. Ø¬ÙˆÙ† Ù…ÛŒØ¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ Ùˆ Ù„Ø°Øª Ø¨Ø±Ø¯Ù† Ø§Ø² Ø´Ù‡Ø±. ";
        else if(t < 35) text += "Ù‡ÙˆØ§ Ú¯Ø±Ù… Ø´Ø¯Ù‡ Ùˆ Ø¢ÙØªØ§Ø¨ Ø­Ø³Ø§Ø¨ÛŒ Ø¯Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØªØ§Ø¨Ù‡. â˜€ï¸ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù†Ø®ÛŒ Ùˆ Ø±ÙˆØ´Ù† Ø¨Ù¾ÙˆØ´ Ùˆ Ø­ÙˆØ§Ø³Øª Ø¨Ù‡ Ù†ÙˆØ´ÛŒØ¯Ù† Ø¢Ø¨ Ø¨Ø§Ø´Ù‡ ØªØ§ Ú¯Ø±Ù…Ø§Ø²Ø¯Ù‡ Ù†Ø´ÛŒ. ";
        else text += "ÙˆØ§ÛŒ! Ù‡ÙˆØ§ Ø®ÛŒÙ„ÛŒ Ú¯Ø±Ù… Ùˆ Ø³ÙˆØ²Ø§Ù†Ù‡. ğŸ”¥ Ø§Ú¯Ù‡ Ú©Ø§Ø± ÙˆØ§Ø¬Ø¨ÛŒ Ù†Ø¯Ø§Ø±ÛŒØŒ ØªÙˆÛŒ Ø³Ø§ÛŒÙ‡ ÛŒØ§ Ø²ÛŒØ± Ú©ÙˆÙ„Ø± Ø¨Ù…ÙˆÙ†. Ø¨ÛŒØ±ÙˆÙ† Ø±ÙØªÙ† ØªÙˆ Ø§ÛŒÙ† Ú¯Ø±Ù…Ø§ Ø§ØµÙ„Ø§Ù‹ Ø´ÙˆØ®ÛŒ Ù†ÛŒØ³Øª. ";

        if(wCode <= 1) text += isDay ? "Ø¢Ø³Ù…ÙˆÙ† ØµØ§ÙÙ‡ Ùˆ Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø§Ø±Ù‡ Ù„Ø¨Ø®Ù†Ø¯ Ù…ÛŒâ€ŒØ²Ù†Ù‡. Ø¹ÛŒÙ†Ú© Ø¢ÙØªØ§Ø¨ÛŒ ÛŒØ§Ø¯Øª Ù†Ø±Ù‡! ğŸ˜ " : "Ø¢Ø³Ù…ÙˆÙ† ØµØ§Ù Ùˆ Ù¾Ø± Ø§Ø² Ø³ØªØ§Ø±Ù‡â€ŒØ³ØªØŒ Ø§Ú¯Ø± ÙØ±ØµØª Ú©Ø±Ø¯ÛŒ ÛŒÙ‡ Ù†Ú¯Ø§Ù‡ÛŒ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ù†Ø¯Ø§Ø². âœ¨ ";
        else if(wCode <= 3) text += "Ø§Ø¨Ø±Ù‡Ø§ Ø§ÙˆÙ…Ø¯Ù† ØªÙˆ Ø¢Ø³Ù…ÙˆÙ† ÙˆÙ„ÛŒ ÙØ¹Ù„Ø§Ù‹ Ø®Ø¨Ø±ÛŒ Ø§Ø² Ø¨Ø§Ø±ÙˆÙ† Ù†ÛŒØ³ØªØŒ ÙÙ‚Ø· Ù‡ÙˆØ§ Ø±Ùˆ Ø´Ø§Ø¹Ø±Ø§Ù†Ù‡ Ú©Ø±Ø¯Ù†. â˜ï¸ ";
        else if(wCode >= 51 && wCode <= 67 || wCode >= 80) text += "ØµØ¯Ø§ÛŒ Ø¨Ø§Ø±ÙˆÙ† Ù…ÛŒØ§Ø¯! ğŸŒ§ï¸ Ø­ØªÙ…Ø§Ù‹ Ú†ØªØ±Øª Ø±Ùˆ Ø¨Ø±Ø¯Ø§Ø± Ùˆ Ø§Ø² Ø¨ÙˆÛŒ Ø®Ø§Ú© Ø¨Ø§Ø±ÙˆÙ†â€ŒØ®ÙˆØ±Ø¯Ù‡ Ù„Ø°Øª Ø¨Ø¨Ø±ØŒ ÙˆÙ„ÛŒ Ù…ÙˆØ§Ø¸Ø¨ Ù„ÛŒØ² Ø®ÙˆØ±Ø¯Ù† Ø¨Ø§Ø´. ";
        else if(wCode >= 71) text += "Ø¨Ø±Ù Ø¯Ø§Ø±Ù‡ Ù…ÛŒØ§Ø¯ Ùˆ Ù‡Ù…Ù‡ Ø¬Ø§ Ø³ÙÛŒØ¯Ù¾ÙˆØ´ Ø´Ø¯Ù‡! â˜ƒï¸ Ø­Ø³Ø§Ø¨ÛŒ Ù„Ø¨Ø§Ø³ Ø¨Ù¾ÙˆØ´ Ùˆ Ø§Ú¯Ù‡ ØªÙˆÙ†Ø³ØªÛŒ ÛŒÙ‡ Ø¢Ø¯Ù…â€ŒØ¨Ø±ÙÛŒ Ù‡Ù… Ø¯Ø±Ø³Øª Ú©Ù†. ";

        if(wind > 25) text += "Ø¨Ø§Ø¯ Ù†Ø³Ø¨ØªØ§Ù‹ Ø´Ø¯ÛŒØ¯ÛŒ Ù‡Ù… Ø¯Ø§Ø±Ù‡ Ù…ÛŒâ€ŒÙˆØ²Ù‡ØŒ Ù…ÙˆÙ‡Ø§ØªÙˆ Ù…Ø­Ú©Ù… Ø¨Ø¨Ù†Ø¯ Ú†ÙˆÙ† Ø´ÙˆØ®ÛŒ Ù†Ø¯Ø§Ø±Ù‡! ğŸ’¨ ";
        if(hum > 75) text += "Ø±Ø·ÙˆØ¨Øª Ù‡ÙˆØ§ Ù‡Ù… Ø¨Ø§Ù„Ø§Ø³Øª Ùˆ Ù…Ù…Ú©Ù†Ù‡ ÛŒÚ©Ù… Ø§Ø­Ø³Ø§Ø³ Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ú©Ù†ÛŒ. ğŸ’§ ";

        return text;
    }

    // --- Ù¾ÛŒØ§Ù… Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ ---
    function getAirQualityMessage(aqi) {
        if (aqi <= 50) return {
            text: "ØªØ¨Ø±ÛŒÚ©! ğŸ‰ Ø§Ù…Ø±ÙˆØ² Ø±ÛŒÙ‡â€ŒÙ‡Ø§Øª Ù‚Ø±Ø§Ø±Ù‡ Ø¬Ø´Ù† Ø¨Ú¯ÛŒØ±Ù†. Ù‡ÙˆØ§ Ø¨Ù‡â€ŒØ·Ø±Ø² Ø´Ú¯ÙØªâ€ŒØ§Ù†Ú¯ÛŒØ²ÛŒ Ù¾Ø§Ú© Ùˆ Ø²Ù„Ø§Ù„Ù‡.\n\nØªÙˆØµÛŒÙ‡: Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø² Ú©Ù† Ùˆ Ø¨Ø°Ø§Ø± Ù‡ÙˆØ§ÛŒ ØªØ§Ø²Ù‡ Ø¬Ø±ÛŒØ§Ù† Ù¾ÛŒØ¯Ø§ Ú©Ù†Ù‡. Ø§Ú¯Ø± Ø§Ù‡Ù„ ÙˆØ±Ø²Ø´ÛŒØŒ Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ø¯ÙˆÛŒØ¯Ù† ÛŒØ§ Ø¯ÙˆÚ†Ø±Ø®Ù‡â€ŒØ³ÙˆØ§Ø±ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒÙ…Ø¯ØªÙ‡. Ø§Ø² Ù‡Ø± Ù†ÙØ³ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒÚ©Ø´ÛŒ Ù„Ø°Øª Ø¨Ø¨Ø± Ú†ÙˆÙ† Ø§ÛŒÙ† Ø±ÙˆØ²Ù‡Ø§ ØºÙ†ÛŒÙ…ØªÙ‡."
        };
        if (aqi <= 100) return {
            text: "Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„Ù‡ Ùˆ Ø¬Ø§ÛŒ Ù†Ú¯Ø±Ø§Ù†ÛŒ Ø®Ø§ØµÛŒ Ù†ÛŒØ³Øª. ğŸ˜Š\n\nØªÙˆØµÛŒÙ‡: Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø§ Ø®ÛŒØ§Ù„ Ø±Ø§Ø­Øª Ø¨Ù‡ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ù…Ø±Ù‡â€ŒØª Ø¨Ø±Ø³ÛŒ. Ø§Ù„Ø¨ØªÙ‡ Ø§Ú¯Ø± Ø­Ø³Ø§Ø³ÛŒØª Ø®ÛŒÙ„ÛŒ Ø´Ø¯ÛŒØ¯ÛŒ Ø¯Ø§Ø±ÛŒØŒ Ø´Ø§ÛŒØ¯ Ø¨Ù‡ØªØ± Ø¨Ø§Ø´Ù‡ Ø²ÛŒØ§Ø¯ ØªÙˆÛŒ ØªØ±Ø§ÙÛŒÚ© Ù†Ù…ÙˆÙ†ÛŒ. Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø«Ø± Ù…Ø±Ø¯Ù…ØŒ Ø§ÛŒÙ† Ù‡ÙˆØ§ Ù…Ø´Ú©Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ùˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø®ÙˆÙ†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯."
        };
        if (aqi <= 150) return {
            text: "Ù‡ÙˆØ§ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ù†Ø§Ø³Ø§Ù„Ù…Ù‡. ğŸ˜· Ø²Ù†Ú¯ Ø®Ø·Ø± Ø²Ø±Ø¯ Ø¨Ù‡ ØµØ¯Ø§ Ø¯Ø±Ø§ÙˆÙ…Ø¯Ù‡.\n\nØªÙˆØµÛŒÙ‡: Ú©ÙˆØ¯Ú©Ø§Ù†ØŒ Ø³Ø§Ù„Ù…Ù†Ø¯Ø§Ù†ØŒ Ø®Ø§Ù†Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ø¯Ø§Ø± Ùˆ Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¢Ø³Ù… ÛŒØ§ Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ù‚Ù„Ø¨ÛŒ Ø¯Ø§Ø±Ù†Ø¯ØŒ Ø¨Ø§ÛŒØ¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒÙ…Ø¯Øª Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² Ø®ÙˆÙ†Ù‡ Ø±Ùˆ Ú©Ø§Ù‡Ø´ Ø¨Ø¯Ù†. Ø§Ú¯Ø± Ø¬Ø²Ùˆ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ Ù†ÛŒØ³ØªÛŒ Ù‡Ù… Ø¨Ù‡ØªØ±Ù‡ ÙˆØ±Ø²Ø´ Ø³Ù†Ú¯ÛŒÙ† Ø±Ùˆ Ø¨Ø°Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÙ‡ Ø±ÙˆØ² Ø¯ÛŒÚ¯Ù‡."
        };
        if (aqi <= 200) return {
            text: "Ù‡Ø´Ø¯Ø§Ø± Ù‚Ø±Ù…Ø²! â›” Ù‡ÙˆØ§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù†Ø§Ø³Ø§Ù„Ù… Ùˆ Ø¢Ù„ÙˆØ¯Ù‡ Ø§Ø³Øª.\n\nØªÙˆØµÛŒÙ‡: Ø§ÛŒÙ† Ù‡ÙˆØ§ Ù¾Ø± Ø§Ø² Ø°Ø±Ø§Øª Ù…Ø¹Ù„Ù‚Ù‡ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡ÛŒÚ†Ú©Ø³ Ø®ÙˆØ¨ Ù†ÛŒØ³Øª. ØªØ§ Ø¬Ø§ÛŒ Ù…Ù…Ú©Ù† Ø§Ø² Ø®ÙˆÙ†Ù‡ Ø®Ø§Ø±Ø¬ Ù†Ø´Ùˆ. Ø§Ú¯Ø± Ù…Ø¬Ø¨ÙˆØ±ÛŒ Ø¨Ø±ÛŒ Ø¨ÛŒØ±ÙˆÙ†ØŒ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù…Ø§Ø³Ú© ÙÛŒÙ„ØªØ±Ø¯Ø§Ø± (N95) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø¨Ù†Ø¯ Ùˆ Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØµÙÛŒÙ‡ Ù‡ÙˆØ§ Ø±Ùˆ Ø±ÙˆØ´Ù† Ú©Ù†. Ù…Ø§ÛŒØ¹Ø§Øª Ùˆ Ø´ÛŒØ± ÙØ±Ø§ÙˆØ§Ù† Ø¨Ù†ÙˆØ´."
        };
        return {
            text: "ÙˆØ¶Ø¹ÛŒØª Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ùˆ Ø¨Ø³ÛŒØ§Ø± Ø®Ø·Ø±Ù†Ø§Ú©! â˜ ï¸ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø¨Ù‡ Ø­Ø¯ Ø¨Ø­Ø±Ø§Ù†ÛŒ Ø±Ø³ÛŒØ¯Ù‡.\n\nØªÙˆØµÛŒÙ‡: Ø§Ú©ÛŒØ¯Ø§Ù‹ ØªÙˆØµÛŒÙ‡ Ù…ÛŒØ´Ù‡ Ø§Ø² Ù…Ù†Ø²Ù„ Ø®Ø§Ø±Ø¬ Ù†Ø´ÛŒØ¯. Ø§ÛŒÙ† Ù‡ÙˆØ§ Ø³Ù…ÛŒÙ‡ Ùˆ Ù†ÙØ³ Ú©Ø´ÛŒØ¯Ù† ØªÙˆØ´ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¢Ø³ÛŒØ¨ Ø¬Ø¯ÛŒ Ø¨Ø²Ù†Ù‡. ØªÙ…Ø§Ù… Ø¯Ø±Ø²Ù‡Ø§ Ø±Ùˆ Ø¨Ø¨Ù†Ø¯ÛŒØ¯ Ùˆ ÙØ¹Ø§Ù„ÛŒØª Ø¨Ø¯Ù†ÛŒ Ø±Ùˆ Ø¨Ù‡ ØµÙØ± Ø¨Ø±Ø³ÙˆÙ†ÛŒØ¯. Ù…Ø±Ø§Ù‚Ø¨ Ø³Ø§Ù„Ù…Ù†Ø¯Ø§Ù† Ùˆ Ú©ÙˆØ¯Ú©Ø§Ù† Ø¨Ø§Ø´ÛŒØ¯."
        };
    }

    // --- Ø¯Ø§Ø³ØªØ§Ù† Ø¢Ø³Ù…Ø§Ù† ---
    function getDetailedQuote(temp, weatherCode, windSpeed, aqi, timeOfDay) {
        if (aqi > 150) return { title: "ØºØ¨Ø§Ø± ØºÙ…Ú¯ÛŒÙ† Ø´Ù‡Ø±", icon: "ğŸ˜·", text: "Ø´Ù‡Ø± Ø§Ù…Ø±ÙˆØ² Ø²ÛŒØ± Ù„Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ùˆ Ø³Ù†Ú¯ÛŒÙ† Ù¾Ù†Ù‡Ø§Ù† Ø´Ø¯Ù‡. Ù†ÙØ³ Ú©Ø´ÛŒØ¯Ù† Ú©Ù…ÛŒ Ø³Ø®Øªâ€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡â€ŒØ³Øª Ùˆ Ø¢Ø³Ù…Ø§Ù†ØŒ Ø¢Ø¨ÛŒ Ø²ÛŒØ¨Ø§ÛŒØ´ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù‡.\n\nØ¯Ø± Ø§ÛŒÙ† Ø´Ø±Ø§ÛŒØ·ØŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù¾Ù†Ø§Ù‡Ú¯Ø§Ù‡ Ø®Ø§Ù†Ù‡ Ø§Ø³Øª. Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯ØŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ù…Ù„Ø§ÛŒÙ…ÛŒ Ù¾Ø®Ø´ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø¨Ø¯Ù†ØªØ§Ù† Ø¨Ø§ Ù†ÙˆØ´ÛŒØ¯Ù† Ø¢Ø¨ Ùˆ Ø§Ø³ØªØ±Ø§Ø­ØªØŒ Ù‚Ø¯Ø±Øª Ø¯ÙØ§Ø¹ Ø¨Ø¯Ù‡ÛŒØ¯. Ø³Ù„Ø§Ù…ØªÛŒ Ø´Ù…Ø§ Ø§Ø² Ù‡Ø± Ú©Ø§Ø±ÛŒ ÙˆØ§Ø¬Ø¨â€ŒØªØ± Ø§Ø³Øª." };
        if ([71, 73, 75, 85, 86].includes(weatherCode)) return { title: "Ø±Ù‚Øµ Ø¯Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù", icon: "â„ï¸", text: "Ø¢Ø³Ù…Ø§Ù† Ø³Ø®Ø§ÙˆØªÙ…Ù†Ø¯Ø§Ù†Ù‡ Ø§Ù„Ù…Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø³ÙÛŒØ¯Ø´ Ø±Ø§ Ø¨Ù‡ Ø²Ù…ÛŒÙ† Ù‡Ø¯ÛŒÙ‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø³Ú©ÙˆØªÛŒ Ø²ÛŒØ¨Ø§ Ø´Ù‡Ø± Ø±Ø§ ÙØ±Ø§ Ú¯Ø±ÙØªÙ‡ Ú©Ù‡ ÙÙ‚Ø· Ø¨Ø§ ØµØ¯Ø§ÛŒ Ø®Ø±Øªâ€ŒØ®Ø±Øª Ù‚Ø¯Ù…â€ŒÙ‡Ø§ Ø±ÙˆÛŒ Ø¨Ø±Ù Ø´Ú©Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nØ¯Ù†ÛŒØ§ Ø§Ù…Ø±ÙˆØ² Ú©Ù…ÛŒ Ø¢Ù‡Ø³ØªÙ‡â€ŒØªØ± Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ù… Ùˆ Ø±Ø§Ø­Øª Ø¨Ù¾ÙˆØ´ÛŒØ¯ØŒ ÛŒÚ© ÙÙ†Ø¬Ø§Ù† Ú†Ø§ÛŒ Ø¯Ø§Øº Ø¨Ù†ÙˆØ´ÛŒØ¯ Ùˆ Ø§Ø² Ù¾Ø´Øª Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ù‡ Ø§ÛŒÙ† ØªØ§Ø¨Ù„ÙˆÛŒ Ù†Ù‚Ø§Ø´ÛŒ Ø²Ù†Ø¯Ù‡ Ù†Ú¯Ø§Ù‡ Ú©Ù†ÛŒØ¯. Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù„Ø­Ø¸Ø§Øª Ø§Ø³Øª." };
        if ([95, 96, 99].includes(weatherCode)) return { title: "Ø³Ù…ÙÙˆÙ†ÛŒ Ø·ÙˆÙØ§Ù†", icon: "âš¡", text: "Ø¢Ø³Ù…Ø§Ù† Ø§Ù…Ø±ÙˆØ² Ù¾Ø±Ø®Ø§Ø´Ú¯Ø± Ùˆ Ù¾Ø±Ù‡ÛŒØ§Ù‡ÙˆØ³Øª. Ù†ÙˆØ±Ù‡Ø§ÛŒ Ø®ÛŒØ±Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ùˆ ØµØ¯Ø§Ù‡Ø§ÛŒ Ù…Ù‡ÛŒØ¨ØŒ Ù‚Ø¯Ø±Øª Ø·Ø¨ÛŒØ¹Øª Ø±Ø§ Ø¨Ù‡ Ø±Ø® Ù…ÛŒâ€ŒÚ©Ø´Ù†Ø¯.\n\nØ¨Ù‡ØªØ±ÛŒÙ† Ø¬Ø§ Ø²ÛŒØ± Ø³Ù‚Ù Ø§Ù…Ù† Ø®Ø§Ù†Ù‡ Ø§Ø³Øª. Ø§Ø² ØªÙ…Ø§Ø´Ø§ÛŒ Ø§ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ Ø§Ø² Ù¾Ø´Øª Ø´ÛŒØ´Ù‡ Ù„Ø°Øª Ø¨Ø¨Ø±ÛŒØ¯ØŒ Ø§Ù…Ø§ Ø±ÛŒØ³Ú© Ù†Ú©Ù†ÛŒØ¯. Ø·Ø¨ÛŒØ¹Øª Ú¯Ø§Ù‡ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯ ÙØ±ÛŒØ§Ø¯ Ø¨Ø²Ù†Ø¯ ØªØ§ Ø¢Ø±Ø§Ù… Ø´ÙˆØ¯." };
        if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(weatherCode)) {
            if ([63, 65, 81, 82].includes(weatherCode)) return { title: "Ø¨Ø§Ø±Ø§Ù† Ø¨ÛŒâ€ŒØ§Ù…Ø§Ù†", icon: "ğŸŒ§ï¸", text: "Ø§Ù…Ø±ÙˆØ² Ø§Ø¨Ø±Ù‡Ø§ Ø¯Ù„Ø´Ø§Ù† Ù¾Ø± Ø§Ø³Øª Ùˆ ÛŒÚ©â€ŒÙ†ÙØ³ Ù…ÛŒâ€ŒØ¨Ø§Ø±Ù†Ø¯. ØµØ¯Ø§ÛŒ Ø¨Ø§Ø±Ø§Ù† Ø±ÙˆÛŒ Ø´ÛŒØ±ÙˆØ§Ù†ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§ØŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ù…ØªÙ† Ø§Ù…Ø±ÙˆØ² Ø´Ù‡Ø± Ø§Ø³Øª.\n\nÚ†ØªØ±Ù‡Ø§ÛŒ Ù…Ø­Ú©Ù… Ùˆ Ú©ÙØ´â€ŒÙ‡Ø§ÛŒ Ø¶Ø¯Ø¢Ø¨ØŒ Ù‚Ù‡Ø±Ù…Ø§Ù†Ø§Ù† Ø§Ù…Ø±ÙˆØ²Ù†Ø¯. Ø¯Ø± Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ ØµØ¨ÙˆØ± Ø¨Ø§Ø´ÛŒØ¯Ø› Ù‡Ù…Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯ Ø²ÙˆØ¯ØªØ± Ø¨Ù‡ Ø®Ø´Ú©ÛŒ Ø¨Ø±Ø³Ù†Ø¯. Ø¨Ù‡ Ù‚Ø·Ø±Ø§ØªÛŒ Ú©Ù‡ Ø±ÙˆÛŒ Ø´ÛŒØ´Ù‡ Ù…ÛŒâ€ŒÙ„ØºØ²Ù†Ø¯ Ù†Ú¯Ø§Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø¢Ø±Ø§Ù…Ø´ Ø¨Ú¯ÛŒØ±ÛŒØ¯." };
            return { title: "Ù†ÙˆØ§Ø²Ø´ Ù†Ø±Ù… Ø¨Ø§Ø±Ø§Ù†", icon: "â˜”", text: "ÛŒÚ© Ø¨Ø§Ø±Ø§Ù† Ø±ÛŒØ² Ùˆ Ø´Ø§Ø¹Ø±Ø§Ù†Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø´Ø³ØªÙ† ØºØ¨Ø§Ø±Ù‡Ø§ÛŒ Ø´Ù‡Ø± Ø§Ø³Øª. Ù‡ÙˆØ§ Ø¨ÙˆÛŒ Ø®Ø§Ú© Ù†Ù…â€ŒØ®ÙˆØ±Ø¯Ù‡ Ùˆ Ø·Ø±Ø§ÙˆØª Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.\n\nØ§Ú¯Ø± ÙØ±ØµØª Ø¯Ø§Ø±ÛŒØ¯ØŒ Ú©Ù…ÛŒ Ø²ÛŒØ± Ø³Ø§ÛŒÙ‡â€ŒØ¨Ø§Ù† ÛŒØ§ Ø¨Ø§ Ú†ØªØ± Ù‚Ø¯Ù… Ø¨Ø²Ù†ÛŒØ¯. Ø§ÛŒÙ† Ù†ÙˆØ¹ Ø¨Ø§Ø±Ø§Ù† Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø®ÛŒØ³ Ú©Ø±Ø¯Ù†ØŒ Ø¨Ù„Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ§Ø²Ù‡ Ú©Ø±Ø¯Ù† Ø±ÙˆØ­ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØ¨Ø§Ø±Ø¯. Ù†ÙØ³ÛŒ Ø¹Ù…ÛŒÙ‚ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø±ÛŒÙ‡â€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø±Ø§ Ù¾Ø± Ø§Ø² Ø§Ú©Ø³ÛŒÚ˜Ù† Ø®Ø§Ù„Øµ Ú©Ù†ÛŒØ¯." };
        }
        if ([45, 48].includes(weatherCode)) return { title: "Ø´Ù‡Ø± Ø¯Ø± Ù…Ù‡", icon: "ğŸŒ«ï¸", text: "Ø§Ù…Ø±ÙˆØ² Ù…Ø±Ø² Ø¨ÛŒÙ† Ø²Ù…ÛŒÙ† Ùˆ Ø¢Ø³Ù…Ø§Ù† Ú¯Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù…Ù‡ ØºÙ„ÛŒØ¸ÛŒ Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ø±Ø§ Ø¯Ø± Ù‡Ø§Ù„Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø§Ø¨Ù‡Ø§Ù… Ùˆ Ø±Ù…Ø² Ùˆ Ø±Ø§Ø² ÙØ±Ùˆ Ø¨Ø±Ø¯Ù‡.\n\nØ¬Ù‡Ø§Ù† Ú©ÙˆÚ†Ú©â€ŒØªØ± Ùˆ Ø¯Ù†Ø¬â€ŒØªØ± Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ø¯. Ø¯Ø± Ø­Ø±Ú©Øª Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯ØŒ Ú†Ø±Ø§ Ú©Ù‡ Ø¯ÛŒØ¯Ù† Ø¯ÙˆØ±Ø¯Ø³Øªâ€ŒÙ‡Ø§ Ø³Ø®Øª Ø§Ø³Øª. Ø´Ø§ÛŒØ¯ Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø¬Ø§ÛŒ Ù†Ú¯Ø§Ù‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¯ÙˆØ±Ø¯Ø³Øªâ€ŒÙ‡Ø§ØŒ Ø¨Ù‡ Ú†ÛŒØ²Ù‡Ø§ÛŒ Ù†Ø²Ø¯ÛŒÚ© Ùˆ Ø¹Ø²ÛŒØ² ØªÙˆØ¬Ù‡ Ú©Ù†ÛŒÙ…." };
        if (temp < 0) return { title: "Ø³Ø±Ù…Ø§ÛŒ Ø§Ø³ØªØ®ÙˆØ§Ù†â€ŒØ³ÙˆØ²", icon: "ğŸ¥¶", text: "Ù‡ÙˆØ§ Ø¨Ù‡ Ø·Ø±Ø² Ø¨ÛŒâ€ŒØ±Ø­Ù…Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø³Ø±Ø¯ Ø§Ø³Øª. Ø§Ù†Ú¯Ø§Ø± Ø·Ø¨ÛŒØ¹Øª Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú©Ù†Ø¯ Ú©Ù‡ Ú¯Ø±Ù…Ø§ Ú†Ù‡ Ù†Ø¹Ù…Øª Ø¨Ø²Ø±Ú¯ÛŒ Ø§Ø³Øª.\n\nØ§Ù…Ø±ÙˆØ² Ø¨Ø§ Ø®ÙˆØ¯ØªØ§Ù† Ù…Ù‡Ø±Ø¨Ø§Ù† Ø¨Ø§Ø´ÛŒØ¯: Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù¾Ø´Ù…ÛŒØŒ Ø¬ÙˆØ±Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¶Ø®ÛŒÙ… Ùˆ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Øº. Ù†Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø³Ø±Ù…Ø§ Ø¨Ù‡ Ù‚Ù„Ø¨ØªØ§Ù† Ù†ÙÙˆØ° Ú©Ù†Ø¯. Ú¯Ø±Ù…Ø§ÛŒ Ø®Ø§Ù†Ù‡ Ø§Ù…Ø±ÙˆØ² Ø¯Ù„Ú†Ø³Ø¨â€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø³Øª." };
        if (temp > 35) return { title: "Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¨ÛŒâ€ŒØ±Ø­Ù…", icon: "ğŸ”¥", text: "Ø²Ù…ÛŒÙ† Ø§Ù…Ø±ÙˆØ² ØªØ¨ Ø¯Ø§Ø±Ø¯. Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¨Ø§ ØªÙ…Ø§Ù… Ù‚ÙˆØ§ Ù…ÛŒâ€ŒØªØ§Ø¨Ø¯ Ùˆ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ ØªÙ†Ù‡Ø§ Ù¾Ù†Ø§Ù‡Ú¯Ø§Ù‡ Ù…ÙˆØ¬ÙˆØ¯Ø§Øª Ø´Ù‡Ø±Ù†Ø¯.\n\nØ¨Ø¯Ù† Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ Ù…Ø±Ø§Ù‚Ø¨Øª ÙˆÛŒÚ˜Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯: Ø¢Ø¨ ÙØ±Ø§ÙˆØ§Ù†ØŒ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù†Ø®ÛŒ Ùˆ Ø¯ÙˆØ±ÛŒ Ø§Ø² Ø¢ÙØªØ§Ø¨ Ù…Ø³ØªÙ‚ÛŒÙ…. Ø®Ø´Ù… ØªØ§Ø¨Ø³ØªØ§Ù† Ø±Ø§ Ø¨Ø§ ØµØ¨Ø± Ùˆ Ø®Ù†Ú©ÛŒ ØªØ­Ù…Ù„ Ú©Ù†ÛŒØ¯." };
        if (temp >= 15 && temp <= 25) return { title: "Ø¨Ù‡Ø§Ø± Ø¯Ø± Ù‡ÙˆØ§", icon: "ğŸŒ¼", text: "Ø§Ù…Ø±ÙˆØ² Ù‡ÙˆØ§ ØªØ¹Ø§Ø¯Ù„ Ù…Ø­Ø¶ Ø§Ø³Øª. Ù†Ù‡ Ø¢Ù†Ù‚Ø¯Ø± Ú¯Ø±Ù… Ú©Ù‡ Ú©Ù„Ø§ÙÙ‡ Ø´ÙˆÛŒØ¯ØŒ Ù†Ù‡ Ø¢Ù†Ù‚Ø¯Ø± Ø³Ø±Ø¯ Ú©Ù‡ Ø¨Ù„Ø±Ø²ÛŒØ¯. Ù†Ø³ÛŒÙ… Ù…Ù„Ø§ÛŒÙ…ÛŒ ØµÙˆØ±ØªØªØ§Ù† Ø±Ø§ Ù†ÙˆØ§Ø²Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.\n\nØ­ÛŒÙ Ø§Ø³Øª Ø§Ù…Ø±ÙˆØ² Ø±Ø§ ÙÙ‚Ø· Ø¯Ø± Ú†Ù‡Ø§Ø±Ø¯ÛŒÙˆØ§Ø±ÛŒ Ø¨Ú¯Ø°Ø±Ø§Ù†ÛŒØ¯. Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ØŒ Ø¨Ù‡ Ø¨Ø§Ù„Ú©Ù† Ø¨Ø±ÙˆÛŒØ¯ ÛŒØ§ Ù…Ø³ÛŒØ±ÛŒ Ø±Ø§ Ù¾ÛŒØ§Ø¯Ù‡ Ø·ÛŒ Ú©Ù†ÛŒØ¯. Ø§Ù…Ø±ÙˆØ² Ø·Ø¨ÛŒØ¹Øª Ø­Ø§Ù„Ø´ Ø®ÙˆØ¨ Ø§Ø³Øª Ùˆ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ø­Ø§Ù„ Ø´Ù…Ø§ Ø±Ø§ Ù‡Ù… Ø®ÙˆØ¨ Ú©Ù†Ø¯." };
        return { title: "Ø¢Ø³Ù…Ø§Ù† Ø¢Ø±Ø§Ù…", icon: "â˜ï¸", text: "Ø¢Ø³Ù…Ø§Ù† Ø§Ù…Ø±ÙˆØ² Ù¾ÙˆØ´ÛŒØ¯Ù‡ Ø§Ø² Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ù¾Ù†Ø¨Ù‡â€ŒØ§ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¢Ø±Ø§Ù… Ùˆ Ø¨ÛŒâ€ŒØµØ¯Ø§ Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. Ù†ÙˆØ±ÛŒ Ù…Ù„Ø§ÛŒÙ… Ùˆ ÛŒÚ©Ø¯Ø³Øª Ø¨Ø± Ø´Ù‡Ø± ØªØ§Ø¨ÛŒØ¯Ù‡ Ø§Ø³Øª.\n\nØ±ÙˆØ²ÛŒ Ø¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±Ú©Ø² Ùˆ Ø¢Ø±Ø§Ù…Ø´. Ù‡ÛŒÚ† Ø§ØªÙØ§Ù‚ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¢Ø³Ù…Ø§Ù† Ù†ÛŒØ³ØªØ› Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø± ØµÙ„Ø­ Ùˆ Ø³Ú©ÙˆÙ† Ø§Ø³Øª. Ø§Ø² Ø§ÛŒÙ† Ø«Ø¨Ø§Øª Ø¨Ø±Ø§ÛŒ Ø³Ø§Ù…Ø§Ù† Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø§ÙÚ©Ø§Ø±ØªØ§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯." };
    }

    // --- Ù…ØªÙ† Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨Ø§Ø±Ø´ ---
    function getRainMessage(probs) {
        const maxProb = Math.max(...probs);
        if (maxProb < 10) return { t: "Ø¢Ø³Ù…Ø§Ù†ÛŒ Ø®Ø´Ú© Ùˆ Ù…Ø·Ù…Ø¦Ù†", d: "Ø®ÛŒØ§Ù„ØªØ§Ù† Ø±Ø§Ø­Øª! Ø¯Ø± Û²Û´ Ø³Ø§Ø¹Øª Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´ ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ ØµÙØ± Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ø®ÛŒØ§Ù„ Ø±Ø§Ø­Øª Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¶Ø§ÛŒ Ø¨Ø§Ø² Ø¨Ú†ÛŒÙ†ÛŒØ¯." };
        if (maxProb < 40) return { t: "Ø´Ø§ÛŒØ¯ Ú†Ù†Ø¯ Ù‚Ø·Ø±Ù‡", d: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´ Ú©Ù… Ø§Ø³ØªØŒ Ø§Ù…Ø§ Ø´Ø§ÛŒØ¯ Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ú¯Ø°Ø±Ø§ Ú†Ù†Ø¯ Ù‚Ø·Ø±Ù‡â€ŒØ§ÛŒ Ø¨Ø¨Ø§Ø±Ù†Ø¯. Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø¬Ø¯ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ù†ÛŒØ³Øª." };
        if (maxProb < 75) return { t: "Ú†ØªØ±Ù‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø§Ø´Ù†Ø¯", d: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ù†Ø¯Ú¯ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ Ø§Ø³Øª. Ø¨Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ Ø²ÛŒØ§Ø¯ Ø¯Ø± Ø³Ø§Ø¹Ø§ØªÛŒ Ø§Ø² Ø±ÙˆØ² Ø´Ø§Ù‡Ø¯ Ø¨Ø§Ø±Ø´ Ø®ÙˆØ§Ù‡ÛŒÙ… Ø¨ÙˆØ¯. Ù‡Ù…Ø±Ø§Ù‡ Ø¯Ø§Ø´ØªÙ† Ú†ØªØ± Ø¹Ø§Ù‚Ù„Ø§Ù†Ù‡ Ø§Ø³Øª." };
        return { t: "Ø¨Ø§Ø±Ø´ Ù‚Ø·Ø¹ÛŒ Ùˆ ÙØ±Ø§Ú¯ÛŒØ±", d: "Ø¢Ø³Ù…Ø§Ù† Ù‚Ø·Ø¹Ø§Ù‹ Ø®ÙˆØ§Ù‡Ø¯ Ø¨Ø§Ø±ÛŒØ¯. Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÚ© Ø±ÙˆØ² Ø®ÛŒØ³ Ùˆ Ø¨Ø§Ø±Ø§Ù†ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯ Ùˆ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù„Ø§Ø²Ù… Ø±Ø§ Ù‡Ù…Ø±Ø§Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯." };
    }

    // --- Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ---
    function updateUI(data, city) {
        const aqi = data.aqi.current.us_aqi;
        const current = data.weather.current;
        const hour = new Date().getHours();
        const isDay = hour > 6 && hour < 19;
        const wCode = current.weather_code;

        let accent = '#34d399'; 
        let status = 'Ù¾Ø§Ú© Ùˆ Ø¹Ø§Ù„ÛŒ';
        document.body.classList.remove('weather-rain', 'weather-snow');

        if(aqi > 50) { accent = '#facc15'; status = 'Ø³Ø§Ù„Ù… Ùˆ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„'; }
        if(aqi > 100) { accent = '#fb923c'; status = 'Ù†Ø§Ø³Ø§Ù„Ù… Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø³â€ŒÙ‡Ø§'; }
        if(aqi > 150) { accent = '#f87171'; status = 'Ù†Ø§Ø³Ø§Ù„Ù… Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡'; }
        if(aqi > 200) { accent = '#c084fc'; status = 'Ø¨Ø³ÛŒØ§Ø± Ø®Ø·Ø±Ù†Ø§Ú©'; }
        if(aqi > 300) { accent = '#7e22ce'; status = 'Ù…Ø±Ú¯Ø¨Ø§Ø±'; }

        if(wCode >= 95) document.body.classList.add('weather-rain');
        else if(wCode >= 51 && wCode <= 67 || wCode >= 80) document.body.classList.add('weather-rain');
        else if(wCode >= 71) document.body.classList.add('weather-snow');

        document.documentElement.style.setProperty('--accent-color', accent);
        document.documentElement.style.setProperty('--liquid-1', accent);

        document.getElementById('loc-name').innerText = city;
        
        animateValue("aqi-val", 0, aqi, 1500);
        
        document.getElementById('aqi-text').innerText = status;
        document.getElementById('aqi-text').style.backgroundColor = accent;
        
        const offset = 660 - (Math.min(aqi, 400) / 400) * 660;
        document.getElementById('aqi-ring').style.strokeDashoffset = offset;
        document.getElementById('aqi-ring').style.stroke = accent;

        document.getElementById('visual-temp').innerText = toFarsi(Math.round(current.temperature_2m)) + 'Â°';
        const quote = getDetailedQuote(current.temperature_2m, wCode, current.wind_speed_10m, aqi, hour);
        document.getElementById('visual-desc').innerText = quote.title;
        document.getElementById('weather-icon-container').innerHTML = getWeatherSVG(wCode, isDay);
        document.getElementById('hum-val').innerText = toFarsi(current.relative_humidity_2m) + '%';
        document.getElementById('wind-val').innerText = toFarsi(current.wind_speed_10m);

        document.getElementById('friendly-text').innerText = getFriendlyStatus(current.temperature_2m, wCode, current.wind_speed_10m, current.relative_humidity_2m, isDay);

        const aqiMsg = getAirQualityMessage(aqi);
        document.getElementById('aqi-reco-head').innerText = "ÙˆØ¶Ø¹ÛŒØª ØªÙ†ÙØ³ Ø´Ù…Ø§";
        document.getElementById('aqi-reco-body').innerText = aqiMsg.text;

        document.getElementById('story-head').innerText = quote.title;
        document.getElementById('story-icon').innerText = quote.icon;
        document.getElementById('story-body').innerText = quote.text;

        const rainProbs = data.weather.hourly.precipitation_probability.slice(hour, hour+24);
        const rainInfo = getRainMessage(rainProbs);
        document.getElementById('rain-title').innerText = rainInfo.t;
        document.getElementById('rain-desc').innerText = rainInfo.d;

        document.getElementById('pm25-val').innerText = toFarsi(data.aqi.current.pm2_5);
        document.getElementById('no2-val').innerText = toFarsi(data.aqi.current.nitrogen_dioxide);

        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => document.getElementById('loader').style.display = 'none', 600);
    }

    function animateValue(id, start, end, duration) {
        if (start === end) return;
        var range = end - start;
        var current = start;
        var increment = end > start ? 1 : -1;
        var stepTime = Math.abs(Math.floor(duration / range));
        var obj = document.getElementById(id);
        var timer = setInterval(function() {
            current += increment;
            obj.innerHTML = toFarsi(current);
            if (current == end) { clearInterval(timer); }
        }, Math.max(stepTime, 20));
    }

    // --- Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± LocalStorage ---
    async function fetchData(lat, lon, name) {
        document.getElementById('loader').style.display = 'flex';
        setTimeout(() => document.getElementById('loader').style.opacity = '1', 10);
        
        try {
            const [aqiRes, weatherRes] = await Promise.all([
                fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=us_aqi,pm2_5,nitrogen_dioxide&timezone=auto`),
                fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code&hourly=precipitation_probability&timezone=auto`)
            ]);
            
            if(!aqiRes.ok || !weatherRes.ok) throw new Error("API Error");
            
            // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…ÙˆÙÙ‚ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø±
            localStorage.setItem('last_lat', lat);
            localStorage.setItem('last_lon', lon);
            localStorage.setItem('last_name', name);

            updateUI({aqi: await aqiRes.json(), weather: await weatherRes.json()}, name);
        } catch (e) { 
            alert("Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯Ù‡. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => document.getElementById('loader').style.display = 'none', 600);
        }
    }

    function toggleSearch(show) {
        const modal = document.getElementById('search-modal');
        if(show) { modal.classList.add('open'); setTimeout(() => document.getElementById('city-input').focus(), 100); }
        else modal.classList.remove('open');
    }
    
    let debounce;
    document.getElementById('city-input').addEventListener('input', (e) => {
        clearTimeout(debounce);
        if(e.target.value.length < 2) return;
        debounce = setTimeout(async () => {
            try {
                const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${e.target.value}&count=5&language=en&format=json`);
                const data = await res.json();
                const list = document.getElementById('search-list');
                list.innerHTML = '';
                if(!data.results) {
                    list.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.6">Ø´Ù‡Ø±ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯</div>';
                    return;
                }
                data.results?.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.innerText = `${c.name} (${c.country_code})`;
                    div.onclick = () => { fetchData(c.latitude, c.longitude, c.name); toggleSearch(false); };
                    list.appendChild(div);
                });
            } catch(e) {}
        }, 600);
    });

    function getLocation() {
        if(navigator.geolocation) {
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader').style.opacity = '1';
            navigator.geolocation.getCurrentPosition(
                p => fetchData(p.coords.latitude, p.coords.longitude, "Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†"),
                () => { 
                    alert("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯."); 
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('loader').style.display = 'none', 600);
                }
            );
        } else {
            alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.");
        }
    }

    // --- Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø§ÙØ¸Ù‡ ---
    function initApp() {
        const savedLat = localStorage.getItem('last_lat');
        const savedLon = localStorage.getItem('last_lon');
        const savedName = localStorage.getItem('last_name');

        if (savedLat && savedLon && savedName) {
            // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ù‡Ù…Ø§Ù† Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
            fetchData(savedLat, savedLon, savedName);
        } else {
            // Ø§Ú¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø± Ø§Ø³ØªØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ØªÙ‡Ø±Ø§Ù†
            fetchData(35.68, 51.38, "ØªÙ‡Ø±Ø§Ù†");
        }
    }

    initApp();

</script>
</body>
</html>