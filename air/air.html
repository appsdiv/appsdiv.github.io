<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- Ø¯Ø§Ø®Ù„ <head> Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡ -->
<link rel="icon" type="image/png" sizes="32x32" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://8upload.com/image/171db5bf84cf07d4/AppIcon_2x.png">

<meta name="apple-mobile-web-app-title" content="Ù‡ÙˆØ§ÛŒ Ù¾Ø§Ú© Ù¾Ù„Ø§Ø³">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="/manifest.webmanifest">

<title>Ù‡ÙˆØ§ÛŒ Ù¾Ø§Ú© Ù¾Ù„Ø§Ø³</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/misc/Farsi-Digits/font-face.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<style>
    /* --- ØªÙ… Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ --- */
    :root {
        --bg-color: #000000;
        --bg-image: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #000000 100%);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.7);
        --glass-bg: rgba(255, 255, 255, 0.06);
        --glass-border: rgba(255, 255, 255, 0.12);
        --glass-blur: 40px;
        --accent-color: #34d399;
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    body.light-mode {
        --bg-color: #f0f2f5;
        --bg-image: radial-gradient(circle at 50% 0%, #dbeafe 0%, #f0f2f5 100%);
        --text-primary: #1e293b;
        --text-secondary: rgba(30, 41, 59, 0.7);
        --glass-bg: rgba(255, 255, 255, 0.6);
        --glass-border: rgba(255, 255, 255, 0.6);
        --glass-blur: 30px;
        --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }

    body {
        background-color: var(--bg-color);
        background-image: var(--bg-image);
        color: var(--text-primary);
        font-family: 'Vazirmatn', sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
        display: flex; flex-direction: column;
        transition: background 0.5s ease, color 0.5s ease;
    }

    .ambient-glow {
        position: fixed; top: -10%; left: 50%; transform: translateX(-50%);
        width: 120vw; height: 120vw;
        background: radial-gradient(circle, var(--accent-color) 0%, transparent 60%);
        opacity: 0.2; pointer-events: none; z-index: 0;
        transition: background 1s ease;
    }

    #app {
        position: relative; z-index: 10;
        padding: max(20px, env(safe-area-inset-top)) 24px 40px 24px;
        max-width: 500px; margin: 0 auto; width: 100%;
        display: flex; flex-direction: column; gap: 20px;
        opacity: 0; transition: opacity 0.6s ease;
        padding-bottom: 80px;
    }

    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    
    .location-pill {
        display: flex; align-items: center; gap: 8px;
        background: var(--glass-bg); border: 1px solid var(--glass-border);
        padding: 8px 16px; border-radius: 30px;
        font-size: 14px; font-weight: 700; cursor: pointer;
        backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--card-shadow);
        transition: 0.3s;
    }
    .location-pill:active { transform: scale(0.96); }

    .header-actions { display: flex; gap: 10px; }
    .btn-circle {
        width: 40px; height: 40px; border-radius: 50%;
        background: var(--glass-bg); border: 1px solid var(--glass-border);
        display: flex; align-items: center; justify-content: center;
        color: var(--text-primary); cursor: pointer;
        backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--card-shadow);
        transition: 0.3s;
    }

    .hero-aqi {
        position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
        margin-top: 10px;
    }
    .gauge-wrapper { width: 240px; height: 240px; position: relative; }
    .gauge-svg { width: 100%; height: 100%; transform: rotate(-90deg); }
    .track { fill: none; stroke: var(--glass-border); stroke-width: 12; stroke-linecap: round; }
    .progress { 
        fill: none; stroke: var(--accent-color); stroke-width: 12; stroke-linecap: round;
        stroke-dasharray: 660; stroke-dashoffset: 660;
        transition: stroke-dashoffset 1.5s cubic-bezier(0.2, 0.8, 0.2, 1), stroke 1s;
        filter: drop-shadow(0 0 15px var(--accent-color));
    }
    .hero-content {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        text-align: center;
    }
    .hero-val { font-size: 82px; font-weight: 900; line-height: 0.9; letter-spacing: -3px; }
    .hero-label { 
        font-size: 18px; font-weight: 700; color: var(--accent-color); margin-top: 8px; 
        background: var(--glass-bg); padding: 4px 12px; border-radius: 12px;
        backdrop-filter: blur(10px);
    }

    .glass-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 28px; padding: 24px;
        backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--card-shadow);
        text-align: center;
    }

    /* --- Ø¨Ø§Ú©Ø³ Ø¬Ø¯ÛŒØ¯ ØªÙˆØµÛŒÙ‡ Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ --- */
    .aqi-reco-card {
        text-align: right !important;
        border-right: 4px solid var(--accent-color);
        background: linear-gradient(270deg, var(--glass-bg) 0%, rgba(0,0,0,0.02) 100%);
        margin-top: -10px; /* Ú†Ø³Ø¨ÛŒØ¯Ù‡ Ø¨Ù‡ Ú¯ÛŒØ¬ */
    }
    body.light-mode .aqi-reco-card { background: linear-gradient(270deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.2) 100%); }
    .aqi-reco-title { font-size: 15px; font-weight: 800; margin-bottom: 8px; color: var(--accent-color); display: flex; align-items: center; gap: 8px; }
    .aqi-reco-text { font-size: 13px; line-height: 1.8; opacity: 0.95; white-space: pre-line; text-align: justify; }


    .story-card {
        text-align: right !important;
        border-right: 4px solid #60a5fa; /* Ø±Ù†Ú¯ Ø¢Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ */
        background: linear-gradient(90deg, var(--glass-bg) 0%, rgba(0,0,0,0) 100%);
    }
    body.light-mode .story-card { background: linear-gradient(90deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.2) 100%); }
    
    .story-title { font-size: 16px; font-weight: 800; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .story-text { font-size: 13px; line-height: 1.8; opacity: 0.9; white-space: pre-line; text-align: justify; }

    .weather-strip {
        display: grid; grid-template-columns: 1fr 1fr 1fr;
        background: var(--glass-bg); border-radius: 24px;
        padding: 20px; border: 1px solid var(--glass-border); text-align: center;
        backdrop-filter: blur(var(--glass-blur));
    }
    .w-icon { font-size: 24px; margin-bottom: 8px; display: block; }
    .w-val { font-size: 20px; font-weight: 800; margin-bottom: 2px; }
    .w-lbl { font-size: 12px; color: var(--text-secondary); }

    .pollutant-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .p-card {
        background: var(--glass-bg); border-radius: 20px; padding: 16px;
        border: 1px solid var(--glass-border); display: flex; flex-direction: column;
        align-items: center; text-align: center;
        backdrop-filter: blur(var(--glass-blur));
    }
    .p-val { font-size: 24px; font-weight: 800; margin: 5px 0; }
    .p-head { font-size: 12px; color: var(--text-secondary); }
    .p-unit { font-size: 10px; opacity: 0.5; }

    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .chart-title { font-size: 15px; font-weight: 800; display: flex; align-items: center; gap: 8px; }
    .chart-toggles { display: flex; background: rgba(0,0,0,0.1); border-radius: 12px; padding: 4px; border: 1px solid var(--glass-border); }
    .toggle-btn {
        background: transparent; border: none; color: var(--text-secondary);
        padding: 6px 12px; font-size: 12px; font-family: inherit; border-radius: 8px;
        transition: 0.3s; cursor: pointer;
    }
    .toggle-btn.active { background: var(--text-primary); color: var(--bg-color); font-weight: 700; }

    footer {
        text-align: center; font-size: 12px; color: var(--text-secondary);
        margin-top: 20px; padding-bottom: 10px; opacity: 0.7; font-weight: 500;
    }

    .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100;
        backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: flex-end;
        opacity: 0; pointer-events: none; transition: 0.4s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-sheet {
        width: 100%; max-width: 500px; background: var(--bg-color);
        border-top-left-radius: 30px; border-top-right-radius: 30px;
        padding: 24px; transform: translateY(100%); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        border-top: 1px solid var(--glass-border);
        max-height: 80vh; display: flex; flex-direction: column;
    }
    .modal-overlay.open .modal-sheet { transform: translateY(0); }
    .search-input {
        background: var(--glass-bg); border: 1px solid var(--glass-border);
        padding: 16px; border-radius: 18px; color: var(--text-primary); font-family: inherit;
        font-size: 16px; width: 100%; margin-top: 20px; text-align: center;
    }
    .search-results { margin-top: 15px; overflow-y: auto; flex: 1; }
    .search-item { padding: 15px; border-bottom: 1px solid var(--glass-border); cursor: pointer; text-align: center; }

    #loader {
        position: fixed; inset: 0; background: var(--bg-color); z-index: 200;
        display: flex; justify-content: center; align-items: center; flex-direction: column;
        transition: opacity 0.5s;
    }
</style>
</head>
<body>

    <div class="ambient-glow" id="glow"></div>
    
    <div id="loader">
        <svg width="50" height="50" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" fill="none" stroke-dasharray="32" stroke-dashoffset="32" stroke="var(--accent-color)"><animate attributeName="stroke-dashoffset" from="64" to="0" dur="1s" repeatCount="indefinite"/></circle></svg>
        <div style="margin-top: 20px; font-size: 14px; opacity: 0.7;">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ù‚ÛŒÙ‚...</div>
    </div>

    <div class="modal-overlay" id="search-modal">
        <div class="modal-sheet">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:18px; font-weight:800;">ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Ø¹ÛŒØª</span>
                <button onclick="toggleSearch(false)" style="background:none; border:none; color:var(--text-primary); font-size:24px;">âœ•</button>
            </div>
            <input type="text" class="search-input" id="city-input" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." dir="rtl">
            <div class="search-results" id="search-list"></div>
        </div>
    </div>

    <div id="app">
        <header>
            <div class="location-pill" onclick="toggleSearch(true)">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                <span id="loc-name">ØªÙ‡Ø±Ø§Ù†</span>
                <span style="opacity:0.6; font-size:10px;">â–¼</span>
            </div>
            <div class="header-actions">
                <div class="btn-circle" onclick="toggleTheme()">
                    <svg id="theme-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </div>
                <div class="btn-circle" onclick="getLocation()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v20M2 12h20"/><circle cx="12" cy="12" r="6"/></svg>
                </div>
            </div>
        </header>

        <div class="hero-aqi">
            <div class="gauge-wrapper">
                <svg class="gauge-svg" viewBox="0 0 240 240">
                    <circle class="track" cx="120" cy="120" r="110"></circle>
                    <circle id="aqi-ring" class="progress" cx="120" cy="120" r="110"></circle>
                </svg>
                <div class="hero-content">
                    <div class="hero-val" id="aqi-val">--</div>
                    <div class="hero-label" id="aqi-text">...</div>
                </div>
            </div>
        </div>

        <div class="glass-card aqi-reco-card">
            <div class="aqi-reco-title">
                <span>ğŸƒ</span>
                <span id="aqi-reco-head">ØªÙˆØµÛŒÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ù„Ø§Ù…ØªÛŒ</span>
            </div>
            <div class="aqi-reco-text" id="aqi-reco-body">
                Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø°Ø±Ø§Øª Ù…Ø¹Ù„Ù‚ Ùˆ ÙˆØ¶Ø¹ÛŒØª ØªÙ†ÙØ³ÛŒ...
            </div>
        </div>

        <div class="glass-card story-card">
            <div class="story-title" id="story-title">
                <span id="story-icon">âœ¨</span>
                <span id="story-head">ÙˆØ¶Ø¹ÛŒØª Ù‡ÙˆØ§</span>
            </div>
            <div class="story-text" id="story-body">
                Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¬ÙˆÛŒ...
            </div>
        </div>

        <div class="weather-strip">
            <div>
                <span class="w-icon">ğŸŒ¡ï¸</span>
                <div class="w-val" id="temp-val">--Â°</div>
                <div class="w-lbl">Ø¯Ù…Ø§</div>
            </div>
            <div>
                <span class="w-icon">ğŸ’§</span>
                <div class="w-val" id="hum-val">--%</div>
                <div class="w-lbl">Ø±Ø·ÙˆØ¨Øª</div>
            </div>
            <div>
                <span class="w-icon">ğŸ’¨</span>
                <div class="w-val" id="wind-val">--</div>
                <div class="w-lbl">Ø¨Ø§Ø¯ (km/h)</div>
            </div>
        </div>

        <div class="glass-card" style="border-right: 4px solid #60a5fa; text-align: right;">
            <div class="chart-title" style="color:#60a5fa !important; justify-content: flex-start; margin-bottom: 8px;">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"/><path d="M13 11l-4 4"/><path d="M9 11l4 4"/></svg>
                Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨Ø§Ø±Ø´
            </div>
            <div>
                <div style="font-size:14px; font-weight:800;" id="rain-title">--</div>
                <div style="font-size:12px; opacity:0.8; margin-top:4px;" id="rain-desc">--</div>
            </div>
        </div>

        <div class="pollutant-grid">
            <div class="p-card">
                <span style="font-size:24px;">ğŸ˜·</span>
                <div class="p-val" id="pm25-val">--</div>
                <div class="p-head">Ø°Ø±Ø§Øª PM2.5</div>
                <div class="p-unit">Âµg/mÂ³</div>
            </div>
            <div class="p-card">
                <span style="font-size:24px;">ğŸŒ«ï¸</span>
                <div class="p-val" id="no2-val">--</div>
                <div class="p-head">Ø¯ÛŒâ€ŒØ§Ú©Ø³ÛŒØ¯ Ù†ÛŒØªØ±ÙˆÚ˜Ù†</div>
                <div class="p-unit">ppb</div>
            </div>
        </div>

        <div class="glass-card">
            <div class="chart-header">
                <div class="chart-title">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
                    Ù†Ù…ÙˆØ¯Ø§Ø± Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§
                </div>
                <div class="chart-toggles">
                    <button class="toggle-btn" id="btn-24h" onclick="toggleChart('24h')">Ø³Ø§Ø¹ØªÛŒ</button>
                    <button class="toggle-btn active" id="btn-7d" onclick="toggleChart('7d')">Ø±ÙˆØ²Ø§Ù†Ù‡</button>
                </div>
            </div>
            <div style="position:relative; height:200px; width:100%;">
                <canvas id="chart"></canvas>
            </div>
            <div style="font-size: 11px; opacity: 0.5; margin-top: 10px;">Ù†Ù‚Ø·Ù‡ ØªÙˆÙ¾Ø± Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ² Ø§Ø³Øª</div>
        </div>

        <footer>
            Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ ØªÙˆØ³Ø· <span style="font-weight:700; color:var(--accent-color);">Ù¾ÛŒÙ…Ø§Ù†</span>
        </footer>
    </div>

<script>
    let chartInstance = null;
    let currentLoc = { lat: 35.68, lon: 51.38, name: "ØªÙ‡Ø±Ø§Ù†" };
    let chartDataStore = { hourly: [], daily: [] };
    let isLight = false;

    const toFarsi = (n) => n?.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]) || '-';

    function toggleTheme() {
        isLight = !isLight;
        document.body.classList.toggle('light-mode');
        const icon = document.getElementById('theme-icon');
        if(isLight) {
            icon.innerHTML = '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>';
        } else {
            icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
        }
        const currentMode = document.getElementById('btn-7d').classList.contains('active') ? '7d' : '24h';
        toggleChart(currentMode); 
    }

    // --- Ù…Ù†Ø·Ù‚ ØªÙˆØµÛŒÙ‡ Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ (Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¯Ù‚ÛŒÙ‚) ---
    function getAirQualityMessage(aqi) {
        if (aqi <= 50) return {
            text: "Ù‡ÙˆØ§ Ø§Ù…Ø±ÙˆØ² ÙˆØ§Ù‚Ø¹Ø§Ù‹ ØªÙ…ÛŒØ² Ùˆ Ø¹Ø§Ù„ÛŒÙ‡! ğŸƒ Ø§Ù†Ú¯Ø§Ø± Ø·Ø¨ÛŒØ¹Øª Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ø±ÛŒØ³Øª Ø±Ùˆ Ø²Ø¯Ù‡.\n\nØ§Ù„Ø§Ù† Ø¨Ù‡ØªØ±ÛŒÙ† ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ù‡ Ú©Ù‡ Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†ÛŒ ØªØ§ Ù‡ÙˆØ§ÛŒ ØªØ§Ø²Ù‡ Ø¨Ù¾ÛŒÚ†Ù‡ ØªÙˆÛŒ Ø®ÙˆÙ†Ù‡. Ø§Ú¯Ù‡ Ø§Ù‡Ù„ ÙˆØ±Ø²Ø´ÛŒØŒ Ù¾Ø§Ø±Ú© Ùˆ Ø¯ÙˆÛŒØ¯Ù† Ø§Ù…Ø±ÙˆØ² Ø­Ø³Ø§Ø¨ÛŒ Ù…ÛŒâ€ŒÚ†Ø³Ø¨Ù‡. Ø±ÛŒÙ‡â€ŒÙ‡Ø§Øª Ø§Ù…Ø±ÙˆØ² Ø¯Ø§Ø±Ù† Ø¬Ø´Ù† Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†ØŒ Ù¾Ø³ Ø§Ø² Ø§ÛŒÙ† Ù‡ÙˆØ§ÛŒ Ù¾Ø§Ú© Ù†Ù‡Ø§ÛŒØª Ù„Ø°Øª Ø±Ùˆ Ø¨Ø¨Ø±."
        };
        if (aqi <= 100) return {
            text: "Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„Ù‡ØŒ Ø§Ù…Ø§ Ú©Ø±ÛŒØ³ØªØ§Ù„ÛŒ Ù†ÛŒØ³Øª. ğŸ˜\n\nØ§Ú¯Ù‡ Ø­Ø³Ø§Ø³ÛŒØª ÙØµÙ„ÛŒ ÛŒØ§ Ù…Ø´Ú©Ù„ ØªÙ†ÙØ³ÛŒ Ø®Ø§ØµÛŒ Ù†Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ù…Ø±Ù‡â€ŒØª Ø±Ùˆ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒ. ÙˆÙ„ÛŒ Ø§Ú¯Ù‡ Ø¬Ø²Ùˆ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ÛŒØŒ Ø´Ø§ÛŒØ¯ Ø¨Ù‡ØªØ± Ø¨Ø§Ø´Ù‡ ØªØ§ÛŒÙ… Ø¨ÛŒØ±ÙˆÙ† Ù…ÙˆÙ†Ø¯Ù†Øª Ø±Ùˆ Ú©Ù…ØªØ± Ú©Ù†ÛŒ. Ù‡ÙˆØ§ÛŒ Ø®ÙˆÙ†Ù‡ Ø§Ù…Ù†â€ŒØªØ±Ù‡ØŒ Ù¾Ø³ Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Øª Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¨Ø§Ø² Ù†Ø°Ø§Ø±."
        };
        if (aqi <= 150) return {
            text: "Ù‡ÙˆØ§ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ ÛŒÙ‡â€ŒÚ©Ù… Ø³Ù†Ú¯ÛŒÙ†Ù‡. ğŸ˜·\n\nØ§Ú¯Ù‡ Ø¢Ø³Ù… Ø¯Ø§Ø±ÛŒØŒ Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒØŒ ÛŒØ§ Ø³Ù†â€ŒØª Ø¨Ø§Ù„Ø§Ø³ØªØŒ Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ²Ù Ù…ÙˆÙ†Ø¯Ù† ØªÙˆÛŒ Ø®ÙˆÙ†Ù‡ Ùˆ Ø§Ø³ØªØ±Ø§Ø­Øª Ú©Ø±Ø¯Ù†Ù‡. Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ØªØ±Ù‡ ØªÙˆ Ø­ÛŒØ§Ø· Ø¨Ø§Ø²ÛŒ Ù†Ú©Ù†Ù†. ÙˆØ±Ø²Ø´ Ø³Ù†Ú¯ÛŒÙ† ØªÙˆ ÙØ¶Ø§ÛŒ Ø¨Ø§Ø² Ù‡Ù… Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù†Ù…ÛŒâ€ŒØ´Ù‡ Ú†ÙˆÙ† Ù…Ù…Ú©Ù†Ù‡ Ø²ÙˆØ¯ØªØ± Ø®Ø³ØªÙ‡ Ø¨Ø´ÛŒ ÛŒØ§ Ø³Ø±ÙÙ‡ Ú©Ù†ÛŒ."
        };
        if (aqi <= 200) return {
            text: "Ù‡ÙˆØ§ Ø§ØµÙ„Ø§Ù‹ Ø´ÙˆØ®ÛŒ Ù†Ø¯Ø§Ø±Ù‡! ğŸŒ«ï¸ ØºÙ„Ø¸Øª Ø¢Ù„Ø§ÛŒÙ†Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ù„Ø§Ø³Øª Ùˆ Ø´Ù‡Ø± Ø¯Ø§Ø±Ù‡ Ø³Ø±ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ù‡.\n\nÙ„Ø·ÙØ§Ù‹ØŒ Ù„Ø·ÙØ§Ù‹ Ø§Ú¯Ù‡ Ú©Ø§Ø± ÙˆØ§Ø¬Ø¨ÛŒ Ù†Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ±ÙˆÙ† Ù†Ø±Ùˆ. Ø§Ú¯Ù‡ Ù…Ø¬Ø¨ÙˆØ±ÛŒ Ø¨Ø±ÛŒØŒ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù…Ø§Ø³Ú© ÙÛŒÙ„ØªØ±Ø¯Ø§Ø± (N95) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†. Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ú©ÛŒÙ¾ Ø¨Ø¨Ù†Ø¯ Ùˆ Ù…Ø§ÛŒØ¹Ø§Øª Ùˆ Ø´ÛŒØ± Ùˆ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª ØªØ§Ø²Ù‡ Ø±Ùˆ ÙØ±Ø§Ù…ÙˆØ´ Ù†Ú©Ù† ØªØ§ Ø¨Ø¯Ù†Øª Ø¨ØªÙˆÙ†Ù‡ Ù…Ù‚Ø§ÙˆÙ…Øª Ú©Ù†Ù‡."
        };
        return {
            text: "ÙˆØ¶Ø¹ÛŒØª Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ùˆ Ø®Ø·Ø±Ù†Ø§Ú©! â˜ ï¸ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø¨Ù‡ Ø­Ø¯ Ù‡Ø´Ø¯Ø§Ø± Ø±Ø³ÛŒØ¯Ù‡.\n\nØ§Ù„Ø§Ù† Ø§Ù…Ù†â€ŒØªØ±ÛŒÙ† Ø¬Ø§ÛŒ Ø¯Ù†ÛŒØ§ Ø®ÙˆÙ†Ù‡â€ŒØ³Øª Ø¨Ø§ Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø³ØªÙ‡. Ù‡Ø± Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² Ø®ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¨Ù‡ Ø±ÛŒÙ‡â€ŒÙ‡Ø§Øª Ø¢Ø³ÛŒØ¨ Ø¨Ø²Ù†Ù‡. Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØµÙÛŒÙ‡ Ù‡ÙˆØ§ Ø±Ùˆ Ø±ÙˆØ´Ù† Ú©Ù† Ùˆ Ù…Ø±Ø§Ù‚Ø¨ Ø®ÙˆØ¯Øª Ùˆ Ø¹Ø²ÛŒØ²Ø§Ù†Øª Ø¨Ø§Ø´. Ø§ÛŒÙ† Ù‡ÙˆØ§ Ø³Ù…ÛŒÙ‡!"
        };
    }

    // --- Ù…Ù†Ø·Ù‚ ØªÙˆØµÛŒÙ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ (The Story) ---
// --- Ù…Ù†Ø·Ù‚ Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† ØªÙˆØµÛŒÙÛŒ (Quotes) ---
    function getDetailedQuote(temp, weatherCode, windSpeed, aqi, timeOfDay) {
        // Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ Ø´Ø±Ø§ÛŒØ· Ø®Ø·Ø±Ù†Ø§Ú© ÛŒØ§ Ø®Ø§Øµ Ø§Ø³Øª
        
        // 1. Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø´Ø¯ÛŒØ¯
        if (aqi > 150) return { title: "Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù‡ÙˆØ§ Ùˆ Ú©ÛŒÙÛŒØª Ø¨Ø¯", icon: "ğŸ˜·", text: "Ù‡ÙˆØ§ÛŒ Ø§Ù…Ø±ÙˆØ² ØªÙ…ÛŒØ² Ù†ÛŒØ³ØªØŒ Ø§Ù†Ú¯Ø§Ø± Ø´Ù‡Ø± Ø¯Ø§Ø±Ù‡ Ù†ÙØ³â€ŒÙ†ÙØ³ Ù…ÛŒâ€ŒØ²Ù†Ù‡ ğŸŒ«ï¸\n\nØªØ§ Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú©Ù…ØªØ± Ø¨ÛŒØ±ÙˆÙ† Ø¨Ù…ÙˆÙ†ØŒ Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø¨Ù†Ø¯ØŒ Ùˆ Ø§Ú¯Ø± Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø±ÛŒØŒ Ù…Ø§Ø³Ú© Ø±Ùˆ Ø¬Ø¯ÛŒ Ø¨Ú¯ÛŒØ±.\n\nØ¢Ø¨ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ø®ÙˆØ± Ùˆ Ø¨Ù‡ Ø¨Ø¯Ù†Øª Ø§Ø³ØªØ±Ø§Ø­Øª Ø¨Ø¯Ù‡Ø› ØªÙˆ ÙÙ‚Ø· â€œÛŒÙ‡ Ù†ÙØ±â€ Ù†ÛŒØ³ØªÛŒØŒ ØªÙˆ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Øª Ùˆ Ø¢Ø¯Ù…â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯ÙˆØ³ØªØª Ø¯Ø§Ø±Ù†ØŒ Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ²ÛŒ." };

        // 2. Ø¨Ø±Ù
        if ([71, 73, 75, 85, 86].includes(weatherCode)) {
            if (weatherCode === 71) return { title: "Ø¨Ø±Ù Ù…Ù„Ø§ÛŒÙ… Ùˆ Ø¢Ø±Ø§Ù…", icon: "ğŸŒ¨ï¸", text: "Ø¨Ø±Ù Ø¢Ø±ÙˆÙ…â€ŒØ¢Ø±ÙˆÙ… Ø¯Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØ¨Ø§Ø±Ù‡ØŒ Ø§Ø² Ø§ÙˆÙ† ØµØ­Ù†Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ú¯Ù‡ Ø­ÙˆØ§Ø³Øª Ù†Ø¨Ø§Ø´Ù‡ØŒ Ø²ÛŒØ¨Ø§ÛŒÛŒØ´ Ø±Ùˆ Ø§Ø² Ø¯Ø³Øª Ù…ÛŒâ€ŒØ¯ÛŒ â˜ƒï¸\n\nØ§Ú¯Ù‡ Ø¨Ø§ Ù…Ø§Ø´ÛŒÙ† Ù…ÛŒâ€ŒØ±ÛŒ Ø¨ÛŒØ±ÙˆÙ†ØŒ Ø²Ù†Ø¬ÛŒØ± Ú†Ø±Ø® Ùˆ ÛŒÙ‡ Ø¨Ø·Ø±ÛŒ Ø¢Ø¨ Ùˆ ÛŒÙ‡ Ø®ÙˆØ±Ø§Ú©ÛŒ Ú©ÙˆÚ†ÛŒÚ© Ø¨Ø°Ø§Ø± ØªÙˆ Ù…Ø§Ø´ÛŒÙ†Ø› Ø¨Ø±Ù Ú¯Ø§Ù‡ÛŒ Ø­ÙˆØµÙ„Ù‡â€ŒÛŒ Ù…Ø§ Ø±Ùˆ Ù‡Ù… Ø§Ù…ØªØ­Ø§Ù† Ù…ÛŒâ€ŒÚ©Ù†Ù‡.\n\nØªÙˆ Ø§ÛŒÙ† Ù‡Ù…Ù‡ Ø³ÙÛŒØ¯ÛŒ ÛŒØ§Ø¯Øª Ù†Ø±Ù‡ Ø®ÙˆØ¯Øª Ø±Ùˆ Ù‡Ù… Ø¨Ø¨ÛŒÙ†ÛŒØ› ÛŒÙ‡ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±ØŒ ÛŒÙ‡ Ù„Ø­Ø¸Ù‡ Ù…Ú©Ø« Ú©Ù†ØŒ Ø§ÛŒÙ† Ø±ÙˆØ²Ù‡Ø§ Ù‡Ù… ÛŒÙ‡ Ø±ÙˆØ² Ù…ÛŒâ€ŒØ´Ù† Ø®Ø§Ø·Ø±Ù‡." };
            return { title: "Ø¨Ø±Ù Ø´Ø¯ÛŒØ¯", icon: "â„ï¸", text: "Ø¨Ø±Ù Ø§Ù…Ø±ÙˆØ² Ø¯ÛŒÚ¯Ù‡ Ø´ÙˆØ®ÛŒ Ù†Ø¯Ø§Ø±Ù‡ØŒ Ø§Ù†Ú¯Ø§Ø± Ø¢Ø³Ù…ÙˆÙ† Ù‡Ù…Ù‡ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´ Ø±Ùˆ Ø¨Ø§ Ù‡Ù… Ø±ÛŒØ®ØªÙ‡ Ù¾Ø§ÛŒÛŒÙ† â›„\n\nÙ„Ø¨Ø§Ø³ Ø®ÛŒÙ„ÛŒ Ú¯Ø±Ù…ØŒ Ú©ÙØ´ Ø¶Ø¯Ø¢Ø¨ØŒ Ú©Ù„Ø§Ù‡ØŒ Ø¯Ø³ØªÚ©Ø´â€¦ Ù‡Ø±Ú†ÛŒ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ù…Ù…Ú©Ù†Ù‡ Ú©Ù…Ú© Ú©Ù†Ù‡ØŒ Ø¯Ø±ÛŒØº Ù†Ú©Ù†.\n\nØ§Ú¯Ù‡ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ Ø²Ù†Ø¬ÛŒØ± Ú†Ø±Ø® Ù‡Ù…Ø±Ø§Ù‡Øª Ø¨Ø§Ø´Ù‡ Ùˆ Ø­ÙˆØµÙ„Ù‡â€ŒØªÙˆ Ø²ÛŒØ§Ø¯ Ú©Ù†Ø› Ø§ÛŒÙ† Ù…Ø³ÛŒØ± Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡â€ŒØ³ØªØŒ ÙˆÙ„ÛŒ ØªÙˆ Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ Ù‡Ø³ØªÛŒ." };
        }

        // 3. Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚
        if ([95, 96, 99].includes(weatherCode)) return { title: "Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚", icon: "âš¡", text: "Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚ Ø¢Ø³Ù…ÙˆÙ† Ø±Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±Ø¯Ù‡ Ø¨Ù‡ ÛŒÚ© Ø´ÙˆÛŒ Ù†ÙˆØ± Ùˆ ØµØ¯Ø§ âš¡â›ˆï¸\n\nØªØ§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø²ÛŒØ± Ø³Ù‚Ù Ø¨Ù…ÙˆÙ†ØŒ Ùˆ Ø§Ú¯Ø± Ù…Ø¬Ø¨ÙˆØ± Ø´Ø¯ÛŒ Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø±ÛŒØŒ Ø§Ø² Ø§ÛŒØ³ØªØ§Ø¯Ù† Ø²ÛŒØ± Ø¯Ø±Ø®Øªâ€ŒÙ‡Ø§ Ùˆ Ù†Ø²Ø¯ÛŒÚ© Ú©Ø§Ø¨Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù‚ Ø¯ÙˆØ±ÛŒ Ú©Ù†.\n\nØ§ÛŒÙ†â€ŒØ¬ÙˆØ± Ù‡ÙˆØ§Ù‡Ø§ ÛŒÙ‡ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú©ÙˆÚ†ÛŒÚ©Ù† Ú©Ù‡ Ú†Ù‚Ø¯Ø± Ø¸Ø±ÛŒÙ Ùˆ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯ÛŒÙ…Ø› Ù„Ø·ÙØ§Ù‹ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡ Ù…ÙˆØ§Ø¸Ø¨ Ø®ÙˆØ¯Øª Ø¨Ø§Ø´." };

        // 4. Ø¨Ø§Ø±Ø§Ù†
        if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(weatherCode)) {
            if ([63, 65, 81, 82].includes(weatherCode)) return { title: "Ø¨Ø§Ø±ÙˆÙ† Ø´Ø¯ÛŒØ¯", icon: "ğŸŒ§ï¸", text: "Ø§Ù…Ø±ÙˆØ² Ø¢Ø³Ù…ÙˆÙ† Ø´ÛŒØ± Ø¢Ø¨ Ø±Ùˆ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù‡Ø› Ø¨Ø§Ø±ÙˆÙ† Ø¯Ø±Ø³Øª Ùˆ Ø­Ø³Ø§Ø¨ÛŒ Ù…ÛŒâ€ŒØ¨Ø§Ø±Ù‡ ğŸŒ§ï¸\n\nÚ†ØªØ± Ù…Ø­Ú©Ù…ØŒ Ú©ÙØ´ Ù…Ù†Ø§Ø³Ø¨ Ùˆ ÛŒÙ‡ Ú©Ù…ÛŒ Ø­ÙˆØµÙ„Ù‡â€ŒÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø±Ø§ÛŒ ØªØ±Ø§ÙÛŒÚ© Ù„Ø§Ø²Ù… Ø¯Ø§Ø±ÛŒ.\n\nØ²ÙˆØ¯ØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡ Ø±Ø§Ù‡ Ø¨ÛŒÙØªØŒ Ø®ÙˆØ¯Øª Ø±Ùˆ Ø³Ø±Ø²Ù†Ø´ Ù†Ú©Ù†ØŒ Ùˆ Ø§Ú¯Ù‡ Ø¯ÛŒØ± Ø´Ø¯ØŒ Ø¨Ø¯ÙˆÙ† Ú©Ù‡ ØªÙˆ ØªÙ‚ØµÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ› Ú¯Ø§Ù‡ÛŒ Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· Ù†ÙØ³ Ø¨Ú©Ø´ÛŒÙ… Ùˆ Ø¨Ú¯ÛŒÙ…: â€œØ§Ø´Ú©Ø§Ù„ Ù†Ø¯Ø§Ø±Ù‡ØŒ Ù…Ù‡Ù… Ø§ÛŒÙ†Ù‡ Ø³Ø§Ù„Ù… Ø±Ø³ÛŒØ¯Ù….â€" };
            return { title: "Ù†Ù…â€ŒÙ†Ù… Ø¨Ø§Ø±ÙˆÙ†", icon: "â˜”", text: "Ø§Ø² Ø§ÙˆÙ† Ø¨Ø§Ø±ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ² Ùˆ Ø¢Ø±ÙˆÙ…Ù‡ Ú©Ù‡ Ø¢Ø¯Ù… Ø¯Ù„Ø´ Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ Ø²ÛŒØ±Ø´ Ø±Ø§Ù‡ Ø¨Ø±Ù‡ Ùˆ ÛŒÙ‡ Ø¢Ù‡Ù†Ú¯ Ù…Ù„Ø§ÛŒÙ… Ú¯ÙˆØ´ Ø¨Ø¯Ù‡ â˜”\n\nÚ†ØªØ± Ú©ÙˆÚ†ÛŒÚ© ÛŒØ§ ÛŒÙ‡ Ø¨Ø§Ø±ÙˆÙ†ÛŒ Ø³Ø¨Ú© Ø¨Ø±Ø¯Ø§Ø± Ú©Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø­Ø§Ù„ Ø®ÙˆØ¨ØŒ Ø¨Ø¯ÙˆÙ† Ø®ÛŒØ³ Ø´Ø¯Ù† Ú©Ø§Ù…Ù„ØŒ Ù„Ø°Øª Ø¨Ø¨Ø±ÛŒ.\n\nØ§Ú¯Ù‡ Ø­Ø³Ø´ Ø±Ùˆ Ø¯Ø§Ø´ØªÛŒØŒ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ú¯ÙˆØ´ÛŒ Ø±Ùˆ Ø¨Ø°Ø§Ø± Ú©Ù†Ø§Ø±ØŒ Ø¨Ù‡ ØµØ¯Ø§ÛŒ Ø¨Ø§Ø±ÙˆÙ† Ú¯ÙˆØ´ Ø¨Ø¯Ù‡Ø› Ù‡Ù…ÙˆÙ†â€ŒØ¬Ø§ ØªÙˆÛŒ Ø§ÙˆÙ† Ù„Ø­Ø¸Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ØŒ Ú©Ù„ÛŒ Ø¢Ø±Ø§Ù…Ø´ Ù‚Ø§ÛŒÙ… Ø´Ø¯Ù‡." };
        }

        // 5. Ù…Ù‡
        if ([45, 48].includes(weatherCode)) return { title: "Ù…Ù‡â€ŒØ¢Ù„ÙˆØ¯", icon: "ğŸŒ«ï¸", text: "Ù‡ÙˆØ§ Ø§Ù…Ø±ÙˆØ² Ù…Ù‡â€ŒØ¢Ù„ÙˆØ¯ Ùˆ Ú©Ù…ÛŒ Ø±Ø§Ø²Ø¢Ù„ÙˆØ¯ Ø´Ø¯Ù‡ØŒ Ø§Ù†Ú¯Ø§Ø± Ø´Ù‡Ø± ØªÙˆÛŒ Ø±ÙˆÛŒØ§ ÙØ±Ùˆ Ø±ÙØªÙ‡ ğŸŒ«ï¸\n\nØ§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ùˆ Ø±Ø§Ù‡ Ø±ÙØªÙ†ØŒ Ø§ÛŒÙ† Ø±ÙˆÛŒØ§ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø®Ø·Ø±Ù†Ø§Ú© Ø¨Ø§Ø´Ù‡Ø› Ú†Ø±Ø§Øºâ€ŒÙ‡Ø§ Ø±Ùˆ Ø±ÙˆØ´Ù†â€ŒØªØ± Ú©Ù†ØŒ Ø³Ø±Ø¹ØªØª Ø±Ùˆ Ú©Ù…ØªØ± Ú©Ù† Ùˆ Ø­ÙˆØ§Ø³Øª Ø±Ùˆ Ø¨ÛŒØ´ØªØ±.\n\nØªÙˆ Ø¨Ø±Ø§ÛŒ Ø¢Ø¯Ù…â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯ÙˆØ³ØªØª Ø¯Ø§Ø±Ù† Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…ÛŒØ› Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø§Ø­ØªÛŒØ§Ø· Ø­Ø±Ú©Øª Ú©Ù†." };

        // 6. Ø¯Ù…Ø§
        if (temp < 0) return { title: "Ù‡ÙˆØ§ÛŒ Ø®ÛŒÙ„ÛŒ Ø³Ø±Ø¯", icon: "ğŸ¥¶", text: "Ø§Ù…Ø±ÙˆØ² Ø§Ø² Ø§ÙˆÙ† Ø³ÙˆØ²Ù‡Ø§ÛŒÛŒÙ‡ Ú©Ù‡ Ø¨Ø§ Ø§ÙˆÙ„ÛŒÙ† Ù†ÙØ³ Ú©Ø´ÛŒØ¯Ù† Ù…ÛŒâ€ŒÙÙ‡Ù…ÛŒ Ø²Ù…Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒ Ú¯Ø±ÙØªÙ‡ Ù‚Ø¶ÛŒÙ‡ Ø±Ùˆ ğŸ¥¶\n\nÙ‚Ø¨Ù„ Ø§Ø² Ø§ÛŒÙ†â€ŒÚ©Ù‡ Ø§Ø² Ø¯Ø± Ø¨Ø±ÛŒ Ø¨ÛŒØ±ÙˆÙ†ØŒ ÛŒÙ‡ Ú©Ù… Ø¨Ù‡ Ø®ÙˆØ¯Øª Ù…Ù‡Ø±Ø¨ÙˆÙ†ÛŒ Ú©Ù†: Ú©Ø§Ù¾Ø´Ù† Ú¯Ø±Ù…ØŒ Ø´Ø§Ù„ØŒ Ø¯Ø³ØªÚ©Ø´ØŒ Ø­ØªÛŒ Ø§Ú¯Ù‡ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ú©Ù„Ø§Ù‡ Ø¨Ø§Ù…Ø²Ù‡.\n\nÙ†Ø°Ø§Ø± Ø³Ø±Ù…Ø§ Ø­Ø§Ù„ Ø®ÙˆØ¨Øª Ø±Ùˆ Ø¨Ø¯Ø²Ø¯Ù‡Ø› ØªÙˆ Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² Ù‡Ù…Ù‡â€ŒÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ù‡Ø³ØªÛŒ Ú©Ù‡ Ø§Ù…Ø±ÙˆØ² Ø¨Ø§ÛŒØ¯ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒ." };
        
        if (temp > 35) return { title: "Ù‡ÙˆØ§ÛŒ Ø®ÛŒÙ„ÛŒ Ú¯Ø±Ù…", icon: "ğŸ”¥", text: "Ø§Ù…Ø±ÙˆØ² Ù‡ÙˆØ§ Ø±ÙˆÛŒ Ø­Ø§Ù„Øª â€œÚ©ÙˆØ±Ù‡â€ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ ğŸ”¥\n\nÙ„Ø¨Ø§Ø³ Ø®ÛŒÙ„ÛŒ Ø³Ø¨Ú© Ùˆ Ø±ÙˆØ´Ù† Ø¨Ù¾ÙˆØ´ØŒ ØªØ§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ ØªÙˆ Ø³Ø§ÛŒÙ‡ Ø±Ø§Ù‡ Ø¨Ø±Ùˆ Ùˆ Ø­ØªÙ…Ø§Ù‹ ÛŒÙ‡ Ø¨Ø·Ø±ÛŒ Ø¢Ø¨ Ú©Ù†Ø§Ø±Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´.\n\nØ§Ú¯Ù‡ Ø­Ø³ Ø®Ø³ØªÚ¯ÛŒØŒ Ø³Ø±Ø¯Ø±Ø¯ ÛŒØ§ Ø¨ÛŒâ€ŒØ­ÙˆØµÙ„Ú¯ÛŒ Ú©Ø±Ø¯ÛŒØŒ Ø´Ø§ÛŒØ¯ Ø¨Ø¯Ù†Ù Ù…Ù‡Ø±Ø¨ÙˆÙ†Øª Ø¯Ø§Ø±Ù‡ Ø¨Ù‡Øª Ù…ÛŒâ€ŒÚ¯Ù‡: â€œÙ„Ø·ÙØ§Ù‹ ÛŒÙ‡ Ú©Ù… Ø¢Ø¨ Ùˆ Ø§Ø³ØªØ±Ø§Ø­Øª Ø¨ÛŒØ´ØªØ±â€. Ø¨Ù‡Ø´ Ú¯ÙˆØ´ Ø¨Ø¯Ù‡." };

        if (temp > 28) return { title: "Ú¯Ø±Ù…", icon: "â˜€ï¸", text: "Ø¯Ù…Ø§ÛŒ Ù‡ÙˆØ§ ÙˆØ³Ø· Ø±ÙˆØ² ÛŒÙ‡Ùˆ Ù…ÛŒâ€ŒØ±Ù‡ Ø¨Ø§Ù„Ø§ØŒ Ø·ÙˆØ±ÛŒ Ú©Ù‡ ØµØ¨Ø­ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ø®ÙˆØ¨Ù‡ ÙˆÙ„ÛŒ Ø¸Ù‡Ø± Ø§Ø² Ú¯Ø±Ù…Ø§ Ú©Ù„Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÛŒ ğŸŒ\n\nÛŒÙ‡ Ù„Ø¨Ø§Ø³ Ø³Ø¨Ú© Ø²ÛŒØ± Ù„Ø¨Ø§Ø³Øª Ø¨Ù¾ÙˆØ´ Ú©Ù‡ Ø§Ú¯Ù‡ Ù„Ø§Ø²Ù… Ø´Ø¯ Ø¨ØªÙˆÙ†ÛŒ Ú©Ù…Ø´ Ú©Ù†ÛŒØŒ Ùˆ Ø­ØªÙ…Ø§Ù‹ ÛŒÙ‡ Ø¨Ø·Ø±ÛŒ Ø¢Ø¨ Ù‡Ù…Ø±Ø§Ù‡Øª Ø¨Ø§Ø´Ù‡.\n\nØ¨Ø¯Ù†â€ŒØª Ø¯Ø§Ø±Ù‡ Ø¨Ø±Ø§Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŒ ØªÙˆ Ù‡Ù… Ø¨Ø±Ú¯Ø±Ø¯ Ø¨Ø±Ø§Ø´ ÛŒÙ‡ Ú©Ù… Ù‡ÙˆØ§ÛŒ Ø®Ù†Ú© Ùˆ Ø¢Ø¨ Ù‡Ø¯ÛŒÙ‡ Ø¨Ø¯Ù‡." };

        // 7. Ø¨Ø§Ø¯
        if (windSpeed > 30) return { title: "Ø¨Ø§Ø¯ Ø´Ø¯ÛŒØ¯", icon: "ğŸ’¨", text: "Ø¨Ø§Ø¯ Ø§Ù…Ø±ÙˆØ² Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ø±Ùˆ Ø²ÛŒØ± Ùˆ Ø±Ùˆ Ú©Ø±Ø¯Ù‡Ø› Ø§Ø² Ù…ÙˆÙ‡Ø§ Ú¯Ø±ÙØªÙ‡ ØªØ§ Ø¨Ø±Ú¯â€ŒÙ‡Ø§ÛŒ Ø®ÛŒØ§Ø¨ÙˆÙ† ğŸ’¨\n\nØ§Ú¯Ù‡ Ù‚Ø±Ø§Ø±Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø±ÛŒØŒ Ú©Ù„Ø§Ù‡ØŒ Ø±ÙˆØ³Ø±ÛŒ ÛŒØ§ Ù‡ÙˆØ¯ÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ù†Ø¬Ø§Øªâ€ŒØ¯Ù‡Ù†Ø¯Ù‡â€ŒØª Ø¨Ø§Ø´Ù‡ØŒ Ùˆ Ú†ÛŒØ²Ù‡Ø§ÛŒ Ø³Ø¨Ú© Ùˆ Ø´ÙÙ„ Ø±Ùˆ Ù…Ø­Ú©Ù…â€ŒØªØ± Ù†Ú¯Ù‡ Ø¯Ø§Ø±.\n\nØ¨Ø°Ø§Ø± Ø¨Ø§Ø¯ Ù‡Ø±Ú†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ Ø¨Ø§ Ø¯Ù†ÛŒØ§ Ø¨Ú©Ù†Ù‡ØŒ Ù…Ù‡Ù… Ø§ÛŒÙ†Ù‡ ØªÙˆ ØªØ¹Ø§Ø¯Ù„ Ø®ÙˆØ¯Øª Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒ Ùˆ Ù…Ø­Ú©Ù…â€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§ÛŒØ³ØªÛŒ." };

        // 8. Ù‡ÙˆØ§ÛŒ Ø®ÙˆØ¨ / Ù…Ø¹Ù…ÙˆÙ„ÛŒ
        if (temp >= 15 && temp <= 25) return { title: "Ù‡ÙˆØ§ÛŒ Ø¯Ù„â€ŒÙ†Ø´ÛŒÙ†", icon: "ğŸŒ¼", text: "Ø§Ù…Ø±ÙˆØ² Ø§Ø² Ø§ÙˆÙ† Ø±ÙˆØ²Ù‡Ø§ÛŒÛŒâ€ŒÛŒÙ‡ Ú©Ù‡ Ù‡ÙˆØ§ Ù…ÛŒâ€ŒÚ¯Ù‡: â€œÙ…Ù† Ø­Ø§Ù„Ù… Ø®ÙˆØ¨Ù‡ØŒ Ø¨ÛŒØ§ ØªÙˆ Ù‡Ù… Ø­Ø§Ù„Øª Ø±Ùˆ Ø®ÙˆØ¨ Ú©Ù†â€ ğŸŒ¼\n\nÙ†Ù‡ Ø®ÛŒÙ„ÛŒ Ú¯Ø±Ù…Ù‡ Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø³Ø±Ø¯Ø› ÛŒÙ‡ Ù„Ø¨Ø§Ø³ Ù…Ø¹Ù…ÙˆÙ„ÛŒ ÛŒØ§ ÛŒÙ‡ Ø³ÙˆÛŒØ´Ø±Øª Ù†Ø§Ø²Ú© Ú©Ø§ÙÛŒÙ‡.\n\nØ§Ú¯Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Øª Ø¨Ø±Ø¯Ø§Ø±ØŒ ÛŒÙ‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ Ú©ÙˆØªØ§Ù‡ØŒ ÛŒÙ‡ Ø¨Ø³ØªÙ†ÛŒØŒ ÛŒØ§ Ø­ØªÛŒ Ù†Ø´Ø³ØªÙ† Ù¾Ø´Øª Ù¾Ù†Ø¬Ø±Ù‡ Ùˆ ØªÙ…Ø§Ø´Ø§ Ú©Ø±Ø¯Ù† Ø´Ù‡Ø±â€¦ ØªÙˆ Ù„Ø§ÛŒÙ‚ Ø§ÛŒÙ† Ø§Ø³ØªØ±Ø§Ø­ØªÛŒ." };

        return { title: "Ø§Ø¨Ø±ÛŒ Ù…Ù„Ø§ÛŒÙ…", icon: "â˜ï¸", text: "Ø¢Ø³Ù…ÙˆÙ† Ø§Ù…Ø±ÙˆØ² Ø§Ø¨Ø±ÛŒÙ‡ØŒ Ø§Ù…Ø§ Ù†Ù‡ Ø§ÙˆÙ†â€ŒÙ‚Ø¯Ø± ØªØ±Ø³Ù†Ø§Ú© Ú©Ù‡ Ø¨Ú¯Ù‡ â€œÙ†ÛŒØ§ Ø¨ÛŒØ±ÙˆÙ†â€ â˜ï¸\n\nÙ‡ÙˆØ§ÛŒ Ù…Ù„Ø§ÛŒÙ…ÛŒÙ‡Ø› ÛŒÙ‡ Ù„Ø¨Ø§Ø³ Ù…Ø¹Ù…ÙˆÙ„ÛŒØŒ Ø´Ø§ÛŒØ¯ ÛŒÙ‡ Ù„Ø§ÛŒÙ‡â€ŒÛŒ Ø³Ø¨Ú© Ø§Ø¶Ø§ÙÙ‡.\n\nØ§Ú¯Ù‡ Ø°Ù‡Ù†Øª Ø§Ù…Ø±ÙˆØ² Ú©Ù…ÛŒ Ú¯Ø±ÙØªÙ‡â€ŒØ³ØªØŒ Ø¨Ø¯ÙˆÙ† Ú©Ù‡ Ø¢Ø³Ù…Ø§Ù† Ù‡Ù… Ú¯Ø§Ù‡ÛŒ Ø§Ø¨Ø±ÛŒ Ù…ÛŒâ€ŒØ´Ù‡ØŒ Ø§Ù…Ø§ Ø¨Ø¹Ø¯Ø´ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢Ø¨ÛŒ Ù…ÛŒâ€ŒØ´Ù‡Ø› ØªÙˆ Ù‡Ù… Ø­Ù‚ Ø¯Ø§Ø±ÛŒ Ø§ÛŒÙ†â€ŒØ·ÙˆØ±ÛŒ Ø¨Ø§Ø´ÛŒØŒ Ùˆ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆØ´Ù†â€ŒØªØ± Ø¨Ø´ÛŒ." };
    }

    function getRainMessage(probs) {
        const maxProb = Math.max(...probs);
        if (maxProb < 20) return { t: "Ø¢Ø³Ù…Ø§Ù† ØµØ§Ù ØªØ§ Ú©Ù…ÛŒ Ø§Ø¨Ø±ÛŒ", d: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´ Ø¯Ø± Û²Û´ Ø³Ø§Ø¹Øª Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø³ÛŒØ§Ø± Ú©Ù… Ø§Ø³Øª." };
        if (maxProb < 50) return { t: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡", d: "Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ø³Ø§Ø¹Ø§Øª Ø¨Ø§Ø±Ø´ Ø®ÙÛŒÙÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ…." };
        if (maxProb < 80) return { t: "Ø¨Ø§Ø±Ø§Ù†ÛŒ", d: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´ Ø¨Ø§Ù„Ø§Ø³Øª. Ú†ØªØ± Ù‡Ù…Ø±Ø§Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯." };
        return { t: "Ø¨Ø§Ø±Ø´ Ø´Ø¯ÛŒØ¯", d: "Ø¨Ø§Ø±Ù†Ø¯Ú¯ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯." };
    }

    function processDailyData(hourlyTime, hourlyAqi) {
        const dailyMap = {};
        hourlyTime.forEach((time, index) => {
            const date = time.split('T')[0];
            const val = hourlyAqi[index];
            if(val !== null) {
                if(!dailyMap[date]) dailyMap[date] = 0;
                if(val > dailyMap[date]) dailyMap[date] = val;
            }
        });
        const dates = Object.keys(dailyMap).sort().slice(0, 7); 
        return {
            labels: dates.map(d => new Date(d).toLocaleDateString('fa-IR', {weekday:'long'})),
            values: dates.map(d => dailyMap[d])
        };
    }

    function updateUI(data, city) {
        const aqi = data.aqi.current.us_aqi;
        const weather = data.weather.current;

        let accent = '#34d399';
        let statusText = 'Ù¾Ø§Ú©';
        if(aqi > 50) { accent = '#facc15'; statusText = 'Ø³Ø§Ù„Ù…'; }
        if(aqi > 100) { accent = '#fb923c'; statusText = 'Ù†Ø§Ø³Ø§Ù„Ù… Ø­Ø³Ø§Ø³'; }
        if(aqi > 150) { accent = '#f87171'; statusText = 'Ù†Ø§Ø³Ø§Ù„Ù…'; }
        if(aqi > 200) { accent = '#c084fc'; statusText = 'Ø®Ø·Ø±Ù†Ø§Ú©'; }
        
        document.documentElement.style.setProperty('--accent-color', accent);
        document.getElementById('glow').style.background = `radial-gradient(circle, ${accent} 0%, transparent 60%)`;

        document.getElementById('loc-name').innerText = city;
        document.getElementById('aqi-val').innerText = toFarsi(aqi);
        document.getElementById('aqi-text').innerText = statusText;
        document.getElementById('aqi-text').style.color = accent;

        const offset = 660 - (Math.min(aqi, 300) / 300) * 660;
        const ring = document.getElementById('aqi-ring');
        ring.style.strokeDashoffset = offset;
        ring.style.stroke = accent;

        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¨Ø§Ú©Ø³ ØªÙˆØµÛŒÙ‡ Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§ (Ø¬Ø¯ÛŒØ¯)
        const aqiReco = getAirQualityMessage(aqi);
        document.getElementById('aqi-reco-body').innerText = aqiReco.text;
        
        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø³ØªØ§Ù† Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§
        const quote = getDetailedQuote(weather.temperature_2m, weather.weather_code, weather.wind_speed_10m, aqi, new Date().getHours());
        document.getElementById('story-head').innerText = quote.title;
        document.getElementById('story-icon').innerText = quote.icon;
        document.getElementById('story-body').innerText = quote.text;

        document.getElementById('temp-val').innerText = toFarsi(Math.round(weather.temperature_2m)) + 'Â°';
        document.getElementById('hum-val').innerText = toFarsi(weather.relative_humidity_2m) + '%';
        document.getElementById('wind-val').innerText = toFarsi(weather.wind_speed_10m);

        document.getElementById('pm25-val').innerText = toFarsi(data.aqi.current.pm2_5);
        document.getElementById('no2-val').innerText = toFarsi(data.aqi.current.nitrogen_dioxide);

        const now = new Date().getHours();
        const rainProbs = data.weather.hourly.precipitation_probability.slice(now, now+24);
        const rainInfo = getRainMessage(rainProbs);
        document.getElementById('rain-title').innerText = rainInfo.t;
        document.getElementById('rain-desc').innerText = rainInfo.d;

        chartDataStore.hourly = {
            labels: data.aqi.hourly.time.slice(now, now+24).map(t => toFarsi(t.slice(11, 16))),
            data: data.aqi.hourly.us_aqi.slice(now, now+24)
        };
        const dailyData = processDailyData(data.aqi.hourly.time, data.aqi.hourly.us_aqi);
        chartDataStore.daily = {
            labels: dailyData.labels,
            data: dailyData.values
        };

        toggleChart('7d');

        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('app').style.opacity = '1';
        }, 500);
    }

    function toggleChart(mode) {
        document.getElementById('btn-24h').className = mode === '24h' ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btn-7d').className = mode === '7d' ? 'toggle-btn active' : 'toggle-btn';
        
        const data = mode === '24h' ? chartDataStore.hourly : chartDataStore.daily;
        const color = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
        
        let pointColors = Array(data.data.length).fill('#ffffff');
        let pointRadii = Array(data.data.length).fill(3);
        
        if(mode === '7d') {
            pointColors[0] = color;
            pointRadii[0] = 6;
        }

        drawChart(data.labels, data.data, color, pointColors, pointRadii);
    }

    function drawChart(labels, values, color, pColors, pRadii) {
        const ctx = document.getElementById('chart');
        if(!ctx) return;
        
        if(typeof Chart === 'undefined') return;
        if(chartInstance) chartInstance.destroy();

        Chart.defaults.font.family = 'Vazirmatn';
        Chart.defaults.color = isLight ? '#666' : '#aaa';

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    borderColor: color,
                    backgroundColor: color + '33',
                    borderWidth: 3,
                    pointRadius: pRadii,
                    pointBackgroundColor: pColors,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: {display: false} },
                scales: {
                    x: { grid: {display: false}, ticks: { font:{size:11} } },
                    y: { display: false }
                }
            }
        });
    }

    async function fetchData(lat, lon, name) {
        const loader = document.getElementById('loader');
        loader.style.display = 'flex'; loader.style.opacity = '1';
        currentLoc = { lat, lon, name };

        try {
            localStorage.setItem('saved_loc', JSON.stringify({lat, lon, name}));
            const [aqiRes, weatherRes] = await Promise.all([
                fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=us_aqi,pm2_5,nitrogen_dioxide&hourly=us_aqi&timezone=auto&forecast_days=7`),
                fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code&hourly=precipitation_probability&timezone=auto`)
            ]);

            if(!aqiRes.ok || !weatherRes.ok) throw new Error("API Error");
            const aqiData = await aqiRes.json();
            const weatherData = await weatherRes.json();
            updateUI({aqi: aqiData, weather: weatherData}, name);

        } catch (error) {
            console.error(error);
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
            loader.style.opacity = '0';
            setTimeout(()=>loader.style.display='none', 500);
        }
    }

    function toggleSearch(show) {
        const modal = document.getElementById('search-modal');
        if(show) { modal.classList.add('open'); document.getElementById('city-input').focus(); }
        else { modal.classList.remove('open'); }
    }

    let debounce;
    document.getElementById('city-input').addEventListener('input', (e) => {
        clearTimeout(debounce);
        const val = e.target.value;
        if(val.length < 2) return;
        debounce = setTimeout(async () => {
            try {
                const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${val}&count=5&language=en&format=json`);
                const data = await res.json();
                const list = document.getElementById('search-list');
                list.innerHTML = '';
                if(data.results) {
                    data.results.forEach(city => {
                        const div = document.createElement('div');
                        div.className = 'search-item';
                        div.innerText = `${city.name} (${city.country_code})`;
                        div.onclick = () => { fetchData(city.latitude, city.longitude, city.name); toggleSearch(false); };
                        list.appendChild(div);
                    });
                }
            } catch(e) {}
        }, 500);
    });

    function getLocation() {
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                p => fetchData(p.coords.latitude, p.coords.longitude, "Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†"),
                () => alert("GPS Ø®Ø§Ù…ÙˆØ´ Ø§Ø³Øª.")
            );
        } else { alert("Ø¹Ø¯Ù… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² GPS"); }
    }

    const saved = localStorage.getItem('saved_loc');
    if(saved) {
        const l = JSON.parse(saved);
        fetchData(l.lat, l.lon, l.name);
    } else {
        fetchData(35.68, 51.38, "ØªÙ‡Ø±Ø§Ù†");
    }
</script>
</body>
</html>